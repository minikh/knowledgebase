document.querySelectorAll||(document.querySelectorAll=function(t){var e,i=document.createElement("style"),n=[];for(document.documentElement.firstChild.appendChild(i),document._qsa=[],i.styleSheet.cssText=t+"{x-qsa:expression(document._qsa && document._qsa.push(this))}",window.scrollBy(0,0),i.parentNode.removeChild(i);document._qsa.length;)e=document._qsa.shift(),e.style.removeAttribute("x-qsa"),n.push(e);return document._qsa=null,n}),document.querySelector||(document.querySelector=function(t){var e=document.querySelectorAll(t);return e.length?e[0]:null}),function(){function t(){var e={},i=!1,n=null,o=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(i=arguments[0],n++);for(n=0;n<o;n++){var s=arguments[n];!function(n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(i&&"[object Object]"===Object.prototype.toString.call(n[o])?e[o]=t(!0,e[o],n[o]):e[o]=n[o])}(s)}return e}function e(t){var e=t.getBoundingClientRect(),i=document.body,n=document.documentElement,o=window.pageYOffset||n.scrollTop||i.scrollTop,s=window.pageXOffset||n.scrollLeft||i.scrollLeft,r=n.clientTop||i.clientTop||0,a=n.clientLeft||i.clientLeft||0;return{top:e.top+o-r,left:e.left+s-a}}function i(t,e){for(var i=t.className?t.className.split(" "):[],n=0;n<i.length;n++)if(i[n]==e)return;i.push(e),t.className=i.join(" ")}function n(t,e){for(var i=t.className.split(" "),n=0;n<i.length;n++)i[n]==e&&(i.splice(n,1),n--);t.className=i.join(" ")}function o(t){var e=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?decodeURIComponent(e[1]):void 0}function s(t,e,i){var n=null;return e=e||100,function(){function o(){i||t.apply(s,r),n=null}var s=this,r=arguments;null!==n?clearTimeout(n):i&&t.apply(s,r),n=setTimeout(o,e)}}function r(t){return!(0===t.offsetWidth&&0===t.offsetHeight)}function a(t){if(t=t||600,(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<=t)return!0;for(var e=navigator.userAgent,i=[/iPhone/i,/iPod/i,/iPad/i,/Android/i,/IEMobile/i,/(?=.*\bWindows\b)(?=.*\bARM\b)/i,/BlackBerry/i,/BB10/i,/Opera Mini/i,/(CriOS|Chrome)(?=.*\bMobile\b)/i,/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,/(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)/i],n=0,o=i.length;n<o;++n)if(i[n].test(e))return!0;return!1}function l(){var t=document.querySelector('link[rel="canonical"]');return t&&t.getAttribute("href"),window.location.href}function c(){return{top:window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,left:window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}}function u(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e.join("&")}function d(t){this.name="Медиатор",this.message=t||"Возникла ошибка"}function h(t){throw new d(t)}d.prototype=Object.create(Error.prototype),d.prototype.constructor=d,window._mediatorUtils=t(window._mediatorUtils||{},{extend:t,offset:e,addClass:i,removeClass:n,getCookie:o,debounce:s,isMobile:a,isVisible:r,getLocation:l,getViewportSizes:c,console:h,objectToUrlParams:u})}(),function(){"use strict";function t(){var t=R.getElementById("js-mpf-mediator-init"),e=J.attrs,i={counter:parseInt(t.getAttribute(e.counter)),touchCounter:parseInt(t.getAttribute(e.touchCounter)),sectionByClass:"true"===t.getAttribute(e.useSection),adaptive:"true"===t.getAttribute(e.adaptive),autostart:!("false"===t.getAttribute(e.autostart)),orientation:t.getAttribute(e.orientation)||"vertical"};return i.counter&&i.touchCounter&&(i.adaptive=!0),i.touchCounter&&(i.isMobile=!0,i.counter=i.touchCounter),delete i.touchCounter,i}function e(e){e=e||null;var i=e?this._opts:N(!0,J,$._opts||{},t());return N(!0,{},i,e)}function i(t){"object"!=typeof t&&Y("Переданные опции указаны неверно");var i={cssSels:{}};void 0!==t.target&&(t.target instanceof HTMLElement?i.rootElement=t.target:Y("Контейнер указан неверно")),void 0!==t.targetSelector&&("string"==typeof t.targetSelector&&t.targetSelector?i.cssSels.scrollCont=t.targetSelector:Y("Селектор на контейнер указан неверно")),void 0!==t.article&&(t.article&&t.article.length?i.articleElement=t.article:t.article instanceof HTMLElement?i.articleElement=[t.article]:Y("Контейнер статьи указан неверно")),void 0!==t.articleSelector&&("string"==typeof t.articleSelector&&t.articleSelector?i.cssSels.article=t.articleSelector:Y("Селектор на контейнер указан неверно")),"boolean"==typeof t.isMobile?i.isMobile=t.isMobile:void 0!==t.isMobile&&Y("Флаг типа устройства указан неверно"),void 0!==t.url&&("string"==typeof t.url?this._state.pathname=t.url:Y("Ссылка на страницу указана неверно")),this._opts=e.call(this,i),w.call(this)}function n(){var t=window.navigator.userLanguage||window.navigator.language;return{_timers:{},_handlers:[],_sizes:{},_marks:[],_nodes:null,_events:{scrolls:{},reads:{}},referrer:R.referrer,pathname:I.getLocation(),lang:Q[t]?t:"en",isInited:!1,isStarted:!1}}function o(t){t=t||this._elems.parent;var e=t.querySelectorAll(this._opts.cssSels.section);return[].reduce.call(e,function(t,e){return e.offsetParent&&t.push(e),t},[])}function s(){var t=this._opts,e=t.cssSels,i=t.rootElement||R.querySelector(e.scrollCont);i||(i=R.querySelector("body"));var n={parent:i,article:t.articleElement||i.querySelectorAll(e.article)};return t.sectionByClass?(n.section=o.call(this,i),n.section.length||Y("Не найдена ни одна секция")):(n.article&&(n.article||{}).length||(n.article=i.querySelectorAll("article")),n.article&&(n.article||{}).length||Y('Не найдены блоки "article"')),n}function r(t,e){R.addEventListener(t||"visibilitychange",e)}function a(t,e,i){i=i||window;for(var n=this._state,o=n._handlers,s=t.split(" "),a=!window.addEventListener,l=0;l<s.length;l++){var c={el:i,name:"",func:e,ie:a},u=s[l];"visibilitychange"==u?(c.el=R,"hidden"in R?(c.name=u,r(c.name,e)):"mozHidden"in R?(c.name="mozvisibilitychange",r(c.name,e)):"webkitHidden"in R?(c.name="webkitHidden",r(c.name,e)):"webkitvisibilitychange"in R?(c.name="webkitvisibilitychange",r(c.name,e)):"msHidden"in R?(c.name="msHidden",r(c.name,e)):"onfocusin"in R?R.onfocusin=R.onfocusout=e:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e):a?(u="on"+u,c.name=u,i.attachEvent(u,e)):(c.name=u,i.addEventListener(u,e)),o.push(c)}}function l(){var t=this._state,e=this._elems.parent,i=this._opts.timeouts,n=m.bind(this),o=c.bind(this),s=U(x.bind(this),i.sleep),r=w.bind(this),l=a.bind(this);l("resize",U(o,i.resize)),R.body!==e?l("scroll",U(function(){t.isActivePage=!0,s(),o(),n()},i.scroll),e):l("scroll",U(n,i.scroll)),l("load",o),l("hashchange",r),l("visibilitychange blur focus",function(t){t=t||window.event,s();var e=t.type,i=e in Z?Z[e]:!R.hidden;_.call(this,i,e)}.bind(this)),l("load resize scroll click touchstart keydown hashchange",U(function(t){t=t||window.event,s(),_.call(this,null,t.type)}.bind(this),300,!0)),s()}function c(){var t=this._state;d.call(this),p.call(this),f.call(this),t.isStarted&&m.call(this)}function u(t){var e=[],i=[],n=0;return t&&t.length?(n=t.length-1,[].forEach.call(t,function(t){e.push(t.getBoundingClientRect()),i.push(W(t))})):(e.push(t.getBoundingClientRect()),i.push(W(t))),{rect:{left:e[0].left,right:e[0].right,top:e[0].top,bottom:e[n].bottom,width:e[0].width||e[0].right-e[0].left,height:i[n].top-i[0].top+(e[n].bottom-e[n].top)},offset:i[0]}}function d(){var t=this._elems,e=this._state,i=e._sizes={};for(var n in t)if(t.hasOwnProperty(n)&&t[n]&&("article"!==n||t[n].length)){var o=t[n];if("section"===n&&(o||[]).length){i[n]=[];for(var s=0;s<o.length;s++)i[n][s]=u(o[s])}else{if("article"===n){var r=(o||{}).length;"number"==typeof r&&r>2&&(o=[o[0],o[r-1]])}i[n]=u(o)}}}function h(t){var e=this._opts,i=e.section.count,n=this._elems.section.length,o=Math.floor(n/i),s=o?Math.floor(t/o):t;return s>(i-=1)?i:s}function p(){var t,e,i,n,o=this._elems,s=this._opts,r=this._state,a=r._sizes,l=r._marks,c=K[s.orientation];if(s.sectionByClass)for(t=o.section.length,e=0;e<=t;e++){var u=e==t?e-1:e,d=a.section[u],p=d.offset[c.section.start];n={start:p,end:p+d.rect[c.section.size]},i=l[e],i||(i={meta:h.call(this,e)}),i.pos=e==t?n.end:n.start,i.start=i.pos+s.section.triggerStep,l[e]=i}else{t=s.section.count;var f=a.article.offset[c.article.start],m=a.article.rect[c.article.size],g=r.sectionSize=m/t;for(n={start:f,end:f+m},g<s.section.minSize&&(t=Math.floor(m/s.section.minSize),g=m/t),e=0;e<=t;e++)i=l[e],i||(i={}),i.pos=e==t?n.end:n.start+g*e,i.start=i.pos+s.section.triggerStep,l[e]=i}}function f(){function t(t){var e=this._opts,i=K[e.orientation],n=i.mark.style,o=R.createElement("div"),s=R.createElement("span");return s.style.cssText=t?n.labelLast:n.label,o.appendChild(s),F(o,e.cssClss.mark),o.style.cssText=n.mark,o}function e(t,e){var i=this._state.lang,n=Q[i];return t<e?n.start+" "+n.section+" "+t:n.end+" "+n.section+" "+(t-1)}var i,n=this._opts,o=this._state,s=o._marks,r=o._nodes,a=K[n.orientation];if(r||(r=[]),n.showRule){var l=[],c=R.createDocumentFragment(),u="",d=Math.max(r.length,s.length);for(i=0;i<d;i++){var h=s[i],p=r[i];h?(p||(p=t.call(this,i==d-1),c.appendChild(p)),p.style[a.mark.pos]=h.pos+"px",u=e.call(this,i+1,s.length),p.firstChild.textContent=u,p.firstChild.innerText=u,l[i]=p):p&&R.body.removeChild(p)}R.body.appendChild(c),o._nodes=l}else{if(r.length){for(i=0;i<r.length;i++)R.body.removeChild(r[i]);r=null}o._nodes=r}}function m(){var t=this._state,e=this._elems,i=this._opts,n=[].every.call(i.sectionByClass?e.section:e.article,X);if(t.isActivePage&&t.isInited&&t.isStarted&&n){var o=t._marks,s=t._sizes,r=K[i.orientation],a=I.getViewportSizes(),l=a[r.viewport.start],c=a[r.viewport.size];e.parent!=R.body&&(l=s.parent.offset[r.parent.offsetStart],c=Math.min(c,e.parent[r.parent.clientSize]));for(var u=l+c*i.triggerArea,d=l+c,h=i.sectionByClass?e.section.length:i.section.count,p=i.sectionByClass?o[h].pos:s.article.offset[r.article.start]+s.article.rect[r.article.size],f={reading:t.readingSection,current:null},m=0;m<o.length;m++){var v=o[m];v.pos<d&&(A.call(this,"s",m),m<h&&v.start<u&&(f.current=m))}p<l&&(f.current=null),f.current!=f.reading&&(t.readingSection=f.current,g.call(this))}}function g(){var t=this._opts,e=this._elems,i=this._state,n=t.timeouts.hit,o=i._timers.hit;o&&clearTimeout(o),"number"==typeof i.readingSection&&(i._timers.hit=setTimeout(function o(){var s=i.readingSection,r=[].every.call(t.sectionByClass?e.section:e.article,X);i.isStarted&&i.isActivePage&&"number"==typeof s&&r&&(A.call(this,"ts",s),A.call(this,"t",s)),i._timers.hit=setTimeout(o.bind(this),n)}.bind(this),n))}function v(){var t=this._opts;t.isMobile=t.adaptive?V():t.isMobile}function b(){var t=this._elems,e=this._opts,i=this._state,n=K[e.orientation],s=R.documentElement[n.page.scrollSize],r=i._sizes.parent.rect[n.parent.size],a=e.timeouts.size;(function l(){var d=R.documentElement[n.page.scrollSize],h=u(t.parent).rect[n.parent.size],p=[].every.call(e.sectionByClass?t.section:t.article,X);d===s&&r===h||!p||(s=d,r=h,e.sectionByClass&&(t.section=o.call(this)),c.call(this)),i._timers.size=setTimeout(l.bind(this),a)}).bind(this)()}function w(){var t=this._opts,e=R.location.hash.slice(1);e!==t.hashes.showRule&&e!==t.hashes.debug||(t.showRule=!0,this._state.isStarted&&f.call(this)),e===t.hashes.debug&&(t.debug=!0)}function _(t,e){var i=this._state;"boolean"!=typeof t&&(t=!R.hidden),i.isActivePage=t,this._opts.debug&&(console.log("Медиатор: активность окна "+t+(e?" ("+e+")":"")),R.title=t+(e?" ("+e+")":"")),t&&i.isStarted&&m.call(this)}function y(){var t=this._state,e=t._timers;for(var i in e)e.hasOwnProperty(i)&&clearTimeout(i)}function S(){this._state._handlers.forEach(function(t){var e=t.func,i=t.name,n=t.el;t.ie?n.detachEvent(i,e):n.removeEventListener(i,e)})}function E(t){var e=this._state;e.isInited||Y("невозможно изменить статус активности модуля без предворительной инициализации");var i=e.isStarted,n=t;"boolean"==typeof t?i===t&&Y("Ошибка установки активности модуля"):n=!i,e.isStarted=n}function C(){return this._state.isStarted}function x(){this._state.isStarted&&(this._state.isActivePage=!1,this._opts.debug&&console.log("Медиатор: пользователь не активен"))}function z(t){var e="";if(3===t.nodeType)e=t.nodeValue;else if(1===t.nodeType&&-1===tt.indexOf(t.nodeName))for(var i=t.childNodes,n=i.length;n--;)e+=z(i[n]);return e}function k(t){return t=(t||{}).length?t:[t],[].reduce.call(t,function(t,e){return t+=z(e)},"")}function T(){var t=this._elems,e=this._opts,i=e.sectionByClass?t.section:t.article,n=k(i);n=n.replace(/[\.\,\?\!]/g," ");var o=n.split(/\s/).filter(function(t){return t.length>2});this._state.wordsCount=o.length}function A(t,e){var i=this._opts,n=this._state,o=n._events,s=n._marks,r=o["s"===t?"scrolls":"ts"===t?"reads":""],a=s[e],l=i.sectionByClass,c=B.bind(this);[t+(l?a.meta:e)].concat(l?["_"+t+e]:[]).forEach(function(t){r?r[t]||(c({type:t}),r[t]=!0):c({type:t})})}function B(t){var e=this._opts,i=this._state,n={id:e.counter,type:"sendEvent",action:i.pathname,label:[e.isMobile?"mobile":"desktop"].concat("v"==t.type?[i.wordsCount]:[]).join(","),category:t.type,value:2};window._tmr&&window._tmr.push(n),M.call(this,t),e.debug&&console.log("TopMail: "+(H.stringify?H.stringify(n):n)),"function"==typeof e.onPushEvent&&e.onPushEvent(n)}function M(t){var e=this._opts,i=this._state,n={cid:e.counter,url:i.pathname,ref:i.referrer,p:e.isMobile?2:1,e:t.type};"v"===t.type&&(n.wc=i.wordsCount),P(n),e.debug}function P(t){var e=D(t);(new Image).src="//collector.mediator.media/register/?"+e}function j(){this._opts=e.call(this),this._state=n.call(this),w.call(this),v.call(this),isNaN(this._opts.counter)&&Y("Идентификатор счётчика указан неверно"),this._state.isInited=!0,window._tmr&&window._tmr.push({id:G._opts.counter,type:"pageView",start:(new Date).getTime()})}function q(){this._elems=s.call(this),l.call(this),c.call(this),_.call(this),b.call(this),T.call(this),B.call(this,{type:"v"}),E.call(this,!0)}function L(){this._state.isStarted||(S.call(this),y.call(this))}function O(t){t=t||null;var e=this._state;if(e.isInited)try{e.isStarted&&Y("Модуль уже запущен. Сначала необхдимо остановить его работу"),j.call(this),t&&(i.call(this,t),v.call(this)),q.call(this),_.call(this)}catch(t){console.error(t.name+": "+t.message)}}var R=window.document,I=window._mediatorUtils;if(I){var H=window.JSON||{},N=I.extend,W=I.offset,F=I.addClass,U=I.debounce,V=I.isMobile,X=I.isVisible,Y=I.console,D=I.objectToUrlParams,$={};window._mediator&&($=window._mediator);var G={},J={cssSels:{scrollCont:".js-mediator-container",article:".js-mediator-article",section:".js-mediator-section"},cssClss:{mark:"js-mediator-mark"},attrs:{autostart:"data-autostart",useSection:"data-use-section",counter:"data-counter",touchCounter:"data-mobile-counter",adaptive:"data-adaptive",orientation:"data-orientation"},hashes:{showRule:"mediator",debug:"mediator-debug"},timeouts:{sleep:3e4,hit:5e3,size:2e3,scroll:300,resize:500},section:{minSize:0,count:3,triggerStep:0},rootElement:!1,articleElement:!1,counter:null,showRule:!1,isMobile:!1,sectionByClass:!1,triggerArea:.33,debug:!1,onPushEvent:null},K={vertical:{viewport:{start:"top",size:"height"},page:{scrollSize:"scrollHeight"},parent:{offsetStart:"top",clientSize:"clientHeight",size:"height"},article:{start:"top",size:"height"},section:{start:"top",size:"height"},mark:{pos:"top",style:{mark:"position: absolute; left: 0px; right: 0px; height: 4px; z-index: 9999; background: #F44E4E;",label:"position: absolute; top: -28px; left: 16px; font-family: Arial; font-size: 15px; color: white; background: #F44E4E; line-height: 32px; padding: 0 16px; display: inline-block; border-radius: 3px;",labelLast:"position: absolute; top: -28px; left: 16px; font-family: Arial; font-size: 15px; color: white; background: #F44E4E; line-height: 32px; padding: 0 16px; display: inline-block; border-radius: 3px;"}}},horizontal:{viewport:{start:"left",size:"width"},page:{scrollSize:"scrollWidth"},parent:{offsetStart:"left",clientSize:"clientWidth",size:"width"},article:{start:"left",size:"width"},section:{start:"left",size:"width"},mark:{pos:"left",style:{mark:"position: absolute; bottom: 0px; top: 0px; width: 4px; z-index: 9999; background: #F44E4E;",label:"position: relative; top: 0px; left: 0px; width: 120px; font-family: Arial; font-size: 15px; color: white; background: #F44E4E; line-height: 32px; padding: 0 16px; display: inline-block; border-radius: 3px;",labelLast:"position: relative; top: 0px; left: -152px; width: 120px; font-family: Arial; font-size: 15px; color: white; background: #F44E4E; line-height: 32px; padding: 0 16px; display: inline-block; border-radius: 3px;"}}}},Q={ru:{start:"Начало",end:"Конец",section:"секции"},en:{start:"Begin",end:"End",section:"section"}},Z={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1},tt=["TEXTAREA","SCRIPT","STYLE"],et=function(){try{j.call(G),G._opts.autostart?q.call(G):L.call(G)}catch(t){console.error(t.name+": "+t.message)}var t=E.bind(G),e=function(){this._opts.showRule=!1,f.call(this)}.bind(G);return{start:function(t){O.call(G,t)},stop:function(){t(!1),e(),L.call(G)},pause:function(){t(!1)},continue:function(){t(!0)},redraw:function(){G._opts.sectionByClass&&(G._elems.section=o.call(G)),c.call(G)},isActive:function(){return C.call(G)}}};(function t(){if(!("_tmr"in window))return void setTimeout(t.bind(this),300);window._mediator=et()}).call(this)}}();
//# sourceMappingURL=mpf-mediator.min.js.map
