function show_form_errors(e){if("undefined"!=typeof e.errors){for(var t in e.errors)classname=t.replace(/[\]\[]/g,""),$("."+classname+" .error").html(e.errors[t]).fadeIn();$.scrollTo($(".error:visible").first(),800,{axis:"y",offset:-150})}show_system_error(e)}function show_system_error(e){if(show_system_warnings(e),"undefined"!=typeof e.system_errors)for(var t in e.system_errors)$.jGrowl(e.system_errors[t],{theme:"error"})}function show_system_warnings(e){if("undefined"!=typeof e.system_warnings)for(var t in e.system_warnings)$.jGrowl(e.system_warnings[t],{theme:"warning"})}function userFollow(){var e=$(this),t=e.attr("data-login"),s=e.data("id");return e.addClass("loading"),$.post("/json/users/follow/",{login:t},function(t){"ok"==t.messages?($(".js-user_"+s+" .unsubscribeUser").removeClass("hidden"),$(".js-user_"+s+" .subscribeUser").addClass("hidden"),$(".js-user_"+s).addClass("subscribed")):show_system_error(t),e.removeClass("loading")},"json"),!1}function userUnfollow(){var e=$(this),t=e.data("login"),s=e.data("id");return e.addClass("loading"),$.post("/json/users/unfollow/",{login:t},function(t){"ok"==t.messages?($(".js-user_"+s+" .unsubscribeUser").addClass("hidden"),$(".js-user_"+s+" .subscribeUser").removeClass("hidden"),$(".js-user_"+s).removeClass("subscribed")):show_system_error(t),e.removeClass("loading")},"json"),!1}function userKarmaVote(e,t,s,o){return $.post("/json/vote/",{ti:t,tt:s,v:o},function(e){if("ok"==e.messages){var s=$(".js-user_"+t),a=s.find(".js-karma");1===o?(a.addClass("voted_plus"),$(".js-vote_plus",a).attr({title:"Вы проголосовали положительно.",disabled:!0}),$(".js-vote_minus",a).attr({title:"Понизить карму.",disabled:!1})):o===-1?(a.addClass("voted_minus"),$(".js-vote_minus",a).attr({title:"Вы проголосовали отрицательно.",disabled:!0}),$(".js-vote_plus",a).attr({title:"Повысить карму.",disabled:!1})):a.addClass("voted"),$(".js-karma_num",a).text(e.score),"0"!==e.score?$(".js-karma-mark",a).removeClass("voting-wjt__counter_positive voting-wjt__counter_negative").addClass("voting-wjt__counter_"+e.sign):$(".js-karma-mark",a).removeClass("voting-wjt__counter_positive voting-wjt__counter_negative")}else show_system_error(e)},"json"),!1}function _getDate(e){var t=new Array("января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"),s=e.getDate(),o=e.getMonth(),a=e.getFullYear();return s+" "+t[o]+" "+a}function _getTime(e){var t=e.getHours(),s=e.getMinutes();return s<10&&(s="0"+s),t+":"+s}function timer_countdown(e){days=Math.floor(e/86400),hours=Math.floor(e/3600),mins=Math.floor(e/60),secs=Math.floor(e),dd=days,hh=hours-24*days,mm=mins-60*hours,ss=secs-60*mins;var t=[];return hh>0&&t.push(hh?addzero(hh):"00"),t.push(mm?addzero(mm):"00"),t.push(ss?addzero(ss):"00"),t.join(":")}function addzero(e){return e<10?"0"+e:e}function plural_str(e,t,s,o){function a(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2}switch(a(e)){case 0:return t;case 1:return s;default:return o}}function replaceURLWithHTMLLinks(e){var t=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/i,s=/(^|\s)@(\w+)/g,o=/(^|\s)#(\w+)/g;return e=e.replace(t,'<a href="$1">$1</a>'),e=e.replace(s,'$1@<a href="https://www.twitter.com/$2">$2</a>'),e=e.replace(o,'$1<a href="https://twitter.com/search?q=%23$2">#$2</a>')}function empty(e){var t=/\s+/g;return e=e.replace(t,""),""===e}function mention_autocomplete(e){e.textcomplete([{match:/(^|\s)@(\w*)$/,template:function(e){return'<img src="'+e.avatar+'" alt="" /> <span class="name">'+e.value+"</span>"},search:function(e,t){e.length>=3?$.getJSON("/json/mentions/",{term:e}).done(function(e){t(e.results)}).fail(function(){t([])}):t([])},replace:function(e){return"$1@"+e.value+" "}}])}function createCookie(e,t,s){if(s){var o=new Date;o.setTime(o.getTime()+24*s*60*60*1e3);var a="; expires="+o.toGMTString()}else{var a="";document.cookie=e+"="+t+a+"; path=/"}}function getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}function makeAdClass(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",s=getRandomInt(4,12),o=0;o<s;o++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function btnFollow(e,t,s){var o=e.attr("data-state"),a=e.find(".js-btn-value"),n=e.closest(".js-subscribe_item"),r=n.find(".js-subscribed"),i=t+o+"/";$.post(i,s,function(t){"ok"===t.messages?"unfollow"===o?(e.attr("data-state","follow").removeClass("btn_subscribed").addClass("btn_subscribe"),a.text("Подписаться"),r.removeClass("is-subscribed")):"follow"===o&&(e.attr("data-state","unfollow").removeClass("btn_subscribe").addClass("btn_subscribed"),a.text("Подписан"),r.addClass("is-subscribed")):show_system_error(t)},"json")}function fuzzySearch(e,t){var s,o=t,a=$(".page__footer"),n=e.attr("data-type"),r=o.html(),i=function(){o.html(r),a.show(),s=""},c=function(e,t){var s={query:e,type:n};$.get("/json/suggest/",s,function(e){"ok"===e.messages?(a.hide(),o.html(e.html),t&&t(null,e.html)):(window.show_system_error(e),t&&t(e,null))},"json")};return{reset:i,fetch:c}}function show_uploader(e){var t=$(e),s=$('input[name="upload_id"]',t),o=t.offset();$("img",t).remove(),$("a",t).remove(),s.val(""),t.css("height","60px");var a=$('<form action="/upload/" class="upload_form" method="post" enctype="multipart/form-data" accept="image/gif, image/jpeg"><input type="file" name="image" /><div class="progress"><div class="bar"></div></div><div class="state">Выберите файл для загрузки</div></form>');$("body").append(a),a.css({position:"absolute",left:o.left+1,top:o.top+1});var n=$('input[type="file"]',a),r=$(".bar",a),i=$(".state",a);return t.bind("reset_position",function(){o=t.offset(),a.css({position:"absolute",left:o.left+1,top:o.top+1})}),n.change(function(){var e=g_user_login+(new Date).getTime();a.ajaxSubmit({dataType:"xml",url:"/upload/?X-Progress-ID="+e,iframe:!0,forceSync:!0,resetForm:!0,beforeSubmit:function(t){check_progress=setInterval(function(){$.get("/progress/",{"X-Progress-ID":e},function(e){if("uploading"==e.state){var t=e.received/e.size*100;r.css("width",t+"%"),i.html("Загружено "+e.received+" из "+e.size)}else"done"==e.state&&clearInterval(check_progress)},"json")},500)},success:function(e){if(clearInterval(check_progress),"ok"==$(e).find("message").text())r.css({width:"0%"}),i.html("Файл успешно загружен"),a.remove(),t.append('<img src="'+$(e).find("url").text()+'" alt=""  /><a href="#upload" class="upload_again" onclick="return show_uploader($(this).parent());">удалить или изменить</a>'),t.css("height","auto"),s.val($(e).find("id").text());else{r.css({width:"0%"});var o=$(e).find("error");o?o.each(function(){i.html('<span class="error">'+$(this).text()+"</span>")}):i.html('<span class="error">Загрузка не удалась</span>')}}})}),!1}function show_float_block(e){if($.browser.isMobileDevice=/android|webos|iphone|ipad|ipod|blackberry/i.test(navigator.userAgent.toLowerCase()),!($.browser.isMobileDevice||$(window).width()<1024||$(window).height()<500||screen.width<1024)){if($(".content_left").outerHeight()<$(".sidebar_right").outerHeight())return!1;var t=$(e);if(t.size()){var s=t.width(),o=$(".sidebar_right");if(o.size()){var a=!1,n=$(".content_left"),r=function(){if(0==a)var e=o.offset().top+o.outerHeight();else var e=o.offset().top+o.outerHeight()+t.outerHeight()+20;$(window).width()<1024||$(window).height()<500||screen.width<1024||(t.outerHeight()+this.pageYOffset>n.offset().top+n.outerHeight()?(a===!0&&t.removeClass("float_block").css("width","auto"),a=!1):this.pageYOffset>e?(a===!1&&(t.addClass("float_block").css("width",s+"px"),$(window).height()>t.outerHeight(!0)?t.animate({opacity:0},0,function(){t.animate({opacity:1},500)}):t.removeClass("float_block").css("width","auto")),a=!0):(a===!0&&t.removeClass("float_block").css("width","auto"),a=!1))};$(window).bind("scroll resize",r),r()}}}}function change_post_subscibptions_checkboxes(e){void 0!==typeof e.subscribe_mark&&"1"===e.subscribe_mark&&$("#subscribe_comments").length&&$("#subscribe_comments").attr("checked",!0),void 0!==typeof e.tracker_mark&&"1"===e.tracker_mark&&$("#tracker_comments").length&&$("#tracker_comments").attr("checked",!0)}function posts_poll(e,t,s,o){$(e).ajaxSubmit({data:{ti:o,action:s},form:$(e),beforeSubmit:ajaxFormBeforSubmit,success:ajaxFormSuccess(function(t,s,o,a){$(e).replaceWith(t.question_html)})})}function posts_vote(e,t,s,o){$.post("/json/vote/",{ti:t,tt:s,v:o},function(e){if("ok"==e.messages){var s=$("#infopanel_post_"+t+" .js-voting");1===o?(s.addClass("voted_plus").attr("title","Вы проголосовали положительно."),$(".js-plus",s).attr("disabled","disabled"),$(".js-minus",s).attr("disabled","disabled")):o===-1?(s.addClass("voted_minus").attr("title","Вы проголосовали отрицательно."),$(".js-plus",s).attr("disabled","disabled"),$(".js-minus",s).attr("disabled","disabled")):(s.addClass("voted"),$(".js-plus",s).attr("disabled","disabled"),$(".js-minus",s).attr("disabled","disabled")),$(".js-score",s).replaceWith('<span class="voting-wjt__counter-score js-score" title="Всего '+e.votes_count+": &uarr;"+e.votes_count_plus+" и &darr;"+e.votes_count_minus+'">'+e.score+"</span>"),"0"!==e.score?$(".js-mark",s).addClass("voting-wjt__counter_"+e.sign):$(".js-mark",s).removeClass("voting-wjt__counter_positive voting-wjt__counter_negative"),$("#charge_string").html(e.charge_string)}else show_system_error(e)},"json")}function posts_add_to_favorite(e,t,s){var o=$("#post_"+s+" .tags"),a=$("#infopanel_post_"+s+" .js-favs_count"),n=a.text()?parseInt(a.text()):0,r="";return r=$(e).hasClass("add")?"add":"remove",$.post("/json/favorites/",{tt:t,ti:s,action:r},function(i){if("ok"==i.messages)if("add"==r)$.jGrowl("Публикация добавлена в избранное",{}),$(e).removeClass("add").addClass("remove").attr("title","Удалить из избранного"),0===$(".favourites_edit_tags",o).length&&o.append('<li class="favourites_edit_tags"><a href="#" onclick="return show_edit_tags(this, \''+t+"', "+s+');">изменить свои метки</a></li>'),a.text(n+1),change_post_subscibptions_checkboxes(i),$(e).blur();else{$.jGrowl("Публикация удалена из избранного",{}),$(e).addClass("add").removeClass("remove").attr("title","Добавить в избранное"),$(".favourites_edit_tags",o).remove(),$("#edit_tags_form").hide();var c=n-1;a.text(c?c:""),$("#post_"+s+" .tags li.fav").remove(),$(e).blur()}else show_system_error(i)},"json"),!1}function show_edit_tags(e,t,s){var o=$("#edit_tags_form");$('input[name="tt"]',o).val(t),$('input[name="ti"]',o).val(s);var a=[];return $("#post_"+s+" ul.tags li.fav a").each(function(){a[a.length]=$(this).text()}),$('input[name="tags_string"]',o).val(a.join(", ")).focus(),$("#post_"+s+" .tags").after(o),o.show(),$('input[name="tags_string"]',o).focus(),!1}function close_edit_tags(){return $("#edit_tags_form").hide(),!1}function comments_vote(e,t,s,o,a){return $(e).hasClass("loading")||($(e).addClass("loading"),$.post("/json/vote/",{ti:t,tt:s,pti:o,v:a},function(s){if("ok"==s.messages){var o=$("#voting_"+t);1===a?(o.addClass("voted_plus").attr("title","Вы проголосовали положительно."),$(".js-plus",o).attr("disabled","disabled"),$(".js-minus",o).attr("disabled","disabled")):a===-1?(o.addClass("voted_minus").attr("title","Вы проголосовали отрицательно."),$(".js-plus",o).attr("disabled","disabled"),$(".js-minus",o).attr("disabled","disabled")):(o.addClass("voted"),$(".js-plus",o).attr("disabled","disabled"),$(".js-minus",o).attr("disabled","disabled")),$(".js-score",o).replaceWith('<span class="voting-wjt__counter-score js-score" title="Всего '+s.votes_count+": &uarr;"+s.votes_count_plus+" и &darr;"+s.votes_count_minus+'">'+s.score+"</span>"),"0"!==s.score?$(".js-mark",o).addClass("voting-wjt__counter_"+s.sign):$(".js-mark",o).removeClass("voting-wjt__counter_positive voting-wjt__counter_negative"),s.is_negative?$("#comment_"+t+" > .comment_body > .message").hasClass("bad")||$("#comment_"+t+" > .comment_body > .message").addClass("bad bad1"):$("#comment_"+t+" > .comment_body > .message").removeClass("bad bad1 bad2 bad3 bad4 bad5"),$("#charge_string").html(s.charge_string)}else show_form_errors(s);$(e).removeClass("loading")},"json")),!1}function comments_add_to_favorite(e,t,s){if($(e).hasClass("add")){$(e).removeClass("add").addClass("remove");var o="add"}else{$(e).addClass("add").removeClass("remove");var o="remove"}return $.post("/json/favorites/",{tt:t,ti:s,action:o},function(e){"ok"==e.messages?"add"==o?$.jGrowl("Комментарий добавлен в избранное",{}):$.jGrowl("Комментарий удален из избранного",{}):show_system_error(e)},"json"),!1}function comment_preview(e,t){$(e).ajaxSubmit({data:{action:"preview"},form:$(e),beforeSubmit:function(){$(t).addClass("loading");var s=$('textarea[name="text"]',e).val();if(empty(s))return $.jGrowl("Вы забыли ввести текст комментария",{theme:"error"}),$(t).removeClass("loading"),!1},success:ajaxFormSuccess(function(e,t,s,o){$("#preview_placeholder").html(e.text).show(),$("pre code").each(function(){hljs.highlightBlock(this)}),instagrammProcess()})})}function comment_send(e,t){$(e).ajaxSubmit({data:{action:"add"},form:$(e),dataType:"json",beforeSubmit:function(){$(t).addClass("loading");var s=$('textarea[name="text"]',e).val();if(empty(s))return $.jGrowl("Вы забыли ввести текст комментария",{theme:"error"}),$(t).removeClass("loading"),!1},error:ajaxFormError,success:ajaxFormSuccess(function(t,s,o,a){$("#comments .title").removeClass("hidden");var n;for(n in t.comments)0==$("#comment_"+t.comments[n].id).size()&&(0==t.comments[n].parent_id?$("#comments-list").append(t.comments[n].html):$("#reply_comments_"+t.comments[n].parent_id).append(t.comments[n].html),show_comment_parents(t.comments[n].id),document.unreadcomments.push({id:parseInt(t.comments[n].id)}));t.comments_moderation&&(0==$("#comment_"+t.comments_moderation.id).size()&&(0==t.comments_moderation.parrent_id?$("#comments-list").append(t.comments_moderation.html):$("#reply_comments_"+t.comments_moderation.parrent_id).append(t.comments_moderation.html),show_comment_parents(t.comments_moderation.id),document.unreadcomments.push({id:parseInt(t.comments_moderation.id)})),$("#moderated_placeholder").removeClass("hidden")),"undefined"!=typeof t.ts&&$('input[name="ts"]',e).val(t.ts);var r=$("#xpanel .new");if(r){var i=$(".comment_item .is_new").size();i>0&&r.text(i).show()}$('textarea[name="text"]',e).val(""),$("#preview_placeholder").hide(),$(e).hide(),$(".comment_item .reply").removeClass("hidden");var c=$("#comments_count");c.text(parseInt($("#comments_count").text())+t.comments.length),$("pre code").each(function(){hljs.highlightBlock(this)}),change_post_subscibptions_checkboxes(t),instagrammProcess()})})}function comment_delete(e,t){confirm("Точно удаляем?")?$(e).ajaxSubmit({data:{action:"delete"},form:$(e),dataType:"json",beforeSubmit:function(){$(t).addClass("loading")},error:ajaxFormError,success:ajaxFormSuccess(function(t,s,o,a){$("#comments_form_placeholder").append($(e)),$(e).hide();var n=$("#comment_"+t.comment_id);n.find(".comment_body .info").addClass("deleted"),n.find(".comment_body .info time").after('<time class="time_changed">(комментарий скрыт)</time>')},null,!0)}):($(e).hide(),$(e).parent().siblings(".reply").show())}function comment_update(e,t){$(e).ajaxSubmit({data:{action:"edit"},form:$(e),dataType:"json",beforeSubmit:function(){$(t).addClass("loading");var s=$('textarea[name="text"]',e).val();if(empty(s))return $.jGrowl("Вы забыли ввести текст комментария",{theme:"error"}),$(t).removeClass("loading"),!1},error:ajaxFormError,success:ajaxFormSuccess(function(t,s,o,a){$("#comments_form_placeholder").append($(e)),$(e).hide();var n=$("#comment_"+t.comment_id);$("> .comment_body .message",n).html(t.message),$("> .comment_body .info time",n).html(t.time_changed+' <span class="comment-item__time_changed icon_comment-edit" title="Kомментарий был изменён"><i class="comment-item__sign_changed">(комментарий был изменён)</i></span>'),$(".comment_item .reply").removeClass("hidden"),$("pre code").each(function(){hljs.highlightBlock(this)}),instagrammProcess()},null,!0)})}function comment_show_reply_form(e){clearInterval(window.timer),$(".comment_item .reply").removeClass("hidden");var t=$("#comments_form");if(t.length)$("#preview_placeholder",t).hide(),$('input[name="parent_id"]',t).val(e),$('input[name="comment_id"]',t).val(0),$(".edit,.delete",t).addClass("hidden"),$(".submit",t).removeClass("hidden"),$(".time_left",t).text(""),$("#comment_"+e+" > .comment_body > .reply").addClass("hidden"),$("#comment_"+e+" > .comment_body > .reply_form_placeholder").append(t),t.show(),$("#comment_text",t).focus().val(""),mention_autocomplete($("#comment_text"));else{var s=$("#expired_placeholder");$("#comment_"+e+" > .comment_body > .reply").addClass("hidden"),$("#comment_"+e+" > .comment_body > .reply_form_placeholder").append(s),s.removeClass("hidden")}return!1}function comment_show_edit_form(e){clearInterval(window.timer);var t=$("#comments_form");$("#preview_placeholder",t).hide();var s=$(".time_left",t);return s.text(""),$.post("/json/comment/",{comment_id:e,action:"source"},function(o){if("ok"==o.messages){$(".comment_item .reply").removeClass("hidden"),$('input[name="parent_id"]',t).val(0),$('input[name="comment_id"]',t).val(e),$(".edit,.delete",t).removeClass("hidden"),$(".submit",t).addClass("hidden"),$("#comment_"+e+" > .comment_body > .reply").addClass("hidden"),$("#comment_"+e+" > .comment_body > .reply_form_placeholder").append(t),t.show(),$("#comment_text",t).focus().val(o.text),mention_autocomplete($("#comment_text"));var a=o.time_left;window.timer=setInterval(function(){a>0?(a-=1,s.text(""+timer_countdown(a))):(clearInterval(window.timer),s.text("Время истекло"))},1e3)}else show_system_error(o)}),!1}function comment_show_form(){clearInterval(window.timer),$(".comment_item .reply").removeClass("hidden");var e=$("#comments_form");return $("#preview_placeholder",e).hide(),$('input[name="parent_id"]',e).val(0),$('input[name="comment_id"]',e).val(0),$(".time_left",e).text(""),$("#comments_form_placeholder").append(e),$(".edit,.delete",e).addClass("hidden"),$(".submit",e).removeClass("hidden"),e.show(),$("#comment_text",e).val("").focus(),!1}function removeFromArray(e,t){for(itemIndex in e)if(e[itemIndex]==element)return e.splice(itemIndex,1),e;return null}function getQueryVariable(e){for(var t=window.location.search.substring(1),s=t.split("&"),o=0;o<s.length;o++){var a=s[o].split("=");if(a[0]==e)return unescape(a[1])}return!1}function show_comment_parents(e){var t=$("#comment_"+e),s=$("> .parent_id",t).data("parent_id");t.show(),"undefined"!=typeof s&&show_comment_parents(s)}function xpanel_new_counter_click(e){$(".comment_item").show(),$(".comment_item .show_tree").removeClass("open");var t=$("#xpanel .next_new"),s=$("#xpanel .prev_new"),o=$(this),a=$(".comment_item .is_new"),n=a.length;if(n>0){var r=a.first();$.scrollTo(r,400,{axis:"y"}),setTimeout(function(){r.removeClass("is_new"),n--,o.text(n),0==n&&(o.hide(),s.hide(),t.hide())},450)}else o.text("0").hide(),s.hide(),t.hide();return!1}function xpanel_refresh_button_click(e){var t=$("#xpanel .next_new"),s=$("#xpanel .prev_new"),o=$("#xpanel .new"),a=$(this);if(a.hasClass("loading"))return!1;$(".comment_item").show(),$(".comment_item .show_tree").removeClass("open"),$(".comment_item .is_new").removeClass("is_new"),a.addClass("loading");var n=$("#comments_form"),r={tt:$('input[name="tt"]',n).val(),ti:$('input[name="ti"]',n).val(),ts:$('input[name="ts"]',n).val(),action:"get_new"};return $.post("/json/comment/",r,function(e){for(k in e.comments)0==$("#comment_"+e.comments[k].id).length&&(0==e.comments[k].parent_id?$("#comments-list").append(e.comments[k].html):$("#reply_comments_"+e.comments[k].parent_id).append(e.comments[k].html),show_comment_parents(e.comments[k].id));$('input[name="ts"]',n).val(e.ts),e.comments.length>0?(o.text(e.comments.length).css("display","block"),s.css("display","block"),t.css("display","block")):(o.text("0").hide(),s.hide(),t.hide()),$("#comments_count").text($("#comments .comment_item").size()),a.removeClass("loading"),instagrammProcess()},"json"),!1}function xpanel_prev_new_button_click(){var e=[],t=window.pageYOffset;if($(".comment_item .is_new").each(function(){var s=$(this),o=s.offset().top;if(o-100<t){var a=parseInt($(this).attr("rel"));e.push(a)}}),e.length>0)var s=e[e.length-1],o=$("#comment_"+s+" > .comment_body > .is_new");else var o=$(".comment_item .is_new").last();return o.length&&($(".comment_body.is_selected").removeClass("is_selected"),o.closest(".comment_body").addClass("is_selected"),$.scrollTo(o,0,{axis:"y",offset:-100})),!1}function xpanel_next_new_button_click(){var e=[],t=window.pageYOffset+10;if($(".comment_item .is_new").each(function(){var s=$(this),o=s.offset().top;if(o-100>t){var a=parseInt($(this).attr("rel"));e.push(a)}}),e.length>0)var s=e[0],o=$("#comment_"+s+" > .comment_body > .is_new");else var o=$(".comment_item .is_new").first();return o.length&&($(".comment_body.is_selected").removeClass("is_selected"),o.closest(".comment_body").addClass("is_selected"),$.scrollTo(o,0,{axis:"y",offset:-100})),!1}function instagrammProcess(){"undefined"!=typeof instgrm&&instgrm.Embeds.process()}$(document).ready(function(){"use strict";function e(){function e(){var e=$(".js-content_left").outerHeight(),t=null;return e<a&&(t=e),t}function t(e){s.css("height",e)}var s=$(".sidebar_content-area"),o=$(".sidebar_content-area > div"),a=$(".sidebar_content-area").outerHeight(!0),n=e();if(n)t(n),o.overflowing(s,function(e){o.addClass("is_visible")});else{var r=$(".js-ad_sticky"),i=$(".js-sticky-wrapper");if(o.addClass("is_visible"),$(".js-content_left").outerHeight()>a&&($(".sidebar_content-area").addClass("sticky_init"),r.length)){var c=r.offset().top-i.offset().top-20,l=c;r.hcSticky({top:20,bottomEnd:l,followScroll:!1,stickTo:".js-sticky-wrapper"})}}}$.jGrowl.defaults.closerTemplate="<div>Закрыть все уведомления</div>",$(".help-tip").length&&$(".help-tip").tipTip({maxWidth:"auto",edgeOffset:10}),$(window).load(function(){e()})}),$(window).load(function(){"use strict";var e=!(!window.history||!history.pushState);!e||"#habracut"!==document.location.hash&&"#comments"!==document.location.hash||history.replaceState({},document.title,document.location.pathname+document.location.search)}),$(document).ready(function(){window.ajax_errors_count=0,$(document).on("click",".subscribeUser",userFollow),$(document).on("click",".unsubscribeUser",userUnfollow),$(document).on("submit",'form[data-remote="true"]',function(){var e=$(this);return e.ajaxSubmit({form:e,beforeSubmit:ajaxFormBeforSubmit,error:ajaxFormError,success:ajaxFormSuccess(function(e){"undefined"!=typeof e.message&&$.jGrowl(e.message)})}),!1}),$(document).on("click",'a[data-remote="true"]',function(e){for(var t=$(this),s={},o=0,a=t.get(0).attributes,n=a.length;o<n;o++)if((a.item(o).nodeName+"").indexOf("data-",0)>=0){var r=a.item(o).nodeName;r=r.replace(/data-/g,""),s[r]=$(this).attr("data-"+r)}var i=$.map(s,function(e,t){return t+"="+e}).join("&");$.post(t.attr("href"),i,function(e){}),e.preventDefault()}),$(".join_hub_panel .join_hub").on("click",function(){var e=$(this);e.addClass("loading");var t=$(this).attr("data-id"),s=$("#hub_item_"+t);return $.post("/json/hubs/subscribe/",{hub_id:t},function(t){"ok"==t.messages?($(".leave_hub",s).removeClass("hidden"),$(".join_hub",s).addClass("hidden"),s.addClass("membership")):show_system_error(t),e.removeClass("loading")},"json"),!1}),$(".join_hub_panel .leave_hub").on("click",function(){var e=$(this).attr("data-id"),t=$(this);t.addClass("loading");var s=$("#hub_item_"+e);return $.post("/json/hubs/unsubscribe/",{hub_id:e},function(e){"ok"==e.messages?($(".leave_hub",s).addClass("hidden"),$(".join_hub",s).removeClass("hidden"),s.removeClass("membership")):show_system_error(e),t.removeClass("loading")},"json"),!1}),$(document).ajaxError(function(e,t,s){window.ajax_errors_count>2,$("input.loading, button.loading").attr("disabled",!1).removeClass("loading"),window.ajax_errors_count++}),$(document).ajaxSuccess(function(e,t,s,o){"json"==s.dataType&&o&&"string"==typeof o.debug&&$("#php-debug").replaceWith(o.debug)}),$("pre code").each(function(e,t){hljs.highlightBlock(t,"    ")}),$(document).on("click",".spoiler_title",function(){var e=$(this).closest(".spoiler");e.hasClass("spoiler_open")&&$("iframe",e).attr("src",function(e,t){return t}),$("> .spoiler_text",e).slideToggle(),e.toggleClass("spoiler_open")}),$("#broadcast_tabs_comments, #broadcast_tabs_posts").length&&$("#broadcast_tabs_comments, #broadcast_tabs_posts").tabslet({animation:!0}),$(function(){$("a.js-smoothscroll").on("click",function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var e=$(this.hash);if(e=e.length?e:$("[name="+this.hash.slice(1)+"]"),e.length)return $("html,body").animate({scrollTop:e.offset().top},1e3),!1}})}),$("#global_notify .close").live("click",function(){var e=$(this).attr("data-id"),t=$("#notification_"+e),s=t.next(".inner_notice");return t.remove(),s&&s.removeClass("hidden"),$.post("/json/notifications/close/",{id:e},function(e){"ok"==e.messages||show_system_error(e)},"json"),!1})});var ajaxFormBeforSubmit=function(e,t,s){$(".error",t).text("").hide(),$('input[type="submit"], input[type="button"]',t).attr("disabled",!0)},ajaxFormError=function(e,t){$('input[type="submit"], input[type="button"]',t).attr("disabled",!1).removeClass("loading")},ajaxFormSuccess=function(e,t,s){return function(s,o,a,n){return $('input[type="submit"], input[type="button"]',this.form).attr("disabled",!1).removeClass("loading"),"ok"==s.messages?ajaxFormRedirect(s)?void 0:e(s,o,a,n):(show_form_errors(s),void("function"==typeof t&&t(s,o,a,n)))}},ajaxFormRedirect=function(e){return"undefined"!=typeof e.redirect_debug?($.jGrowl('REDIRECT DEBUG: <a href="'+e.redirect_debug+'">'+e.redirect_debug+"</a>",{theme:"message",sticky:!0}),!0):"undefined"!=typeof e.redirect&&(document.location.href=e.redirect,!0)},K=function(){var e=navigator.userAgent;return{ie:e.match(/MSIE\s([^;]*)/)}}(),H=function(e){var t=new Date,s=new Date(e),o=t-s,a=1e3,n=60*a,r=60*n,i=24*r;return K.ie&&(s=Date.parse(e.replace(/( \+)/," UTC$1"))),isNaN(o)||o<0?"":o<7*a?"right now":o<n?Math.floor(o/a)+" s":o<2*n?"1 m":o<r?Math.floor(o/n)+" m":o<2*r?"1 h":o<i?Math.floor(o/r)+" h":o>i&&o<2*i?"yesterday":o<365*i?Math.floor(o/i)+" d":"over a year ago"};$(document).on("mousedown","a[data-utm]",function(){var e=$(this),t=e.attr("href")+e.data("utm");e.attr("href",t)}),$(document).on("click",".informer > .close",function(){$(".informer").hide(),$.cookie("bttf",1,{expires:60,path:"/"})}),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports={addzero:addzero,ajaxFormBeforSubmit:ajaxFormBeforSubmit,ajaxFormError:ajaxFormError,ajaxFormRedirect:ajaxFormRedirect,ajaxFormSuccess:ajaxFormSuccess,btnFollow:btnFollow,createCookie:createCookie,empty:empty,fuzzySearch:fuzzySearch,_getDate:_getDate,getRandomInt:getRandomInt,_getTime:_getTime,H:H,K:K,makeAdClass:makeAdClass,mention_autocomplete:mention_autocomplete,plural_str:plural_str,replaceURLWithHTMLLinks:replaceURLWithHTMLLinks,show_form_errors:show_form_errors,show_system_error:show_system_error,show_system_warnings:show_system_warnings,timer_countdown:timer_countdown,userFollow:userFollow,userKarmaVote:userKarmaVote,userUnfollow:userUnfollow}),$(document).ready(function(){window.last_scroll_position=0;var e=$("#scroll_to_top"),t=0,s=!1;e.on("click",function(t){t.preventDefault(),e.hasClass("back-down")?(e.attr("title","Наверх").removeClass("back-down"),$.scrollTo(window.last_scroll_position,700,{axis:"y"}),window.last_scroll_position=0):(window.last_scroll_position=window.pageYOffset,e.attr("title","Вниз").addClass("back-down"),$.scrollTo(0,700,{axis:"y"}))}),$(window).on("scroll",function(){window.pageYOffset>100?s||(e.removeClass("hidden"),s=!0):s&&(e.addClass("hidden"),s=!1),t<window.pageYOffset&&e.hasClass("back-down")&&e.removeClass("back-down"),t=window.pageYOffset})});var RecaptchaOptions={lang:"ru",theme:"clean"},check_progress=null;$(window).load(function(){$("form").each(function(){var e=$(this);$('input[type="submit"], input[type="button"]',e).live("click",function(){$(this).addClass("loading")}),$(".item.required",e).each(function(e,t){$(t).hasClass("hubs")?$("input#token-input-hubs",t).live("blur",function(){var e=$('input[name="hubs"]',t).tokenInput("get");0==e.length?$(".error",t).text("Необходимо заполнить поле").show():$(".error",t).text("").hide()}):$('input[type="text"], input[type="password"], textarea',t).on("blur",function(){var e=$(this).val(),s=/\s+/g;e=e.replace(s,""),""==e?$(".error",t).text("Необходимо заполнить поле").show():$(".error",t).text("").hide()})})});var e=$(".select_date");$(".country",e).live("change",function(){var t=$(".region",e),s=$(".city",e);t.attr("disabled",!0),s.attr("disabled",!0),$.get("/json/geo/regions/",{country_id:$(this).val()},function(e){t.html('<option value="0">Регион</option>'),s.html('<option value="0">Город</option>');for(k in e.regions){var o=e.regions[k];t.append('<option value="'+o.id+'">'+o.name+"</option>")}t.attr("disabled",!1)},"json")}),$(".region",e).live("change",function(){var t=$(".city",e);t.attr("disabled",!0),$.get("/json/geo/cities/",{region_id:$(this).val()},function(e){t.html('<option value="0">Город</option>');for(k in e.cities){var s=e.cities[k];t.append('<option value="'+s.id+'">'+s.name+"</option>")}t.attr("disabled",!1)},"json")});var t=$(".iframe_uploader_preview .image");$(".delete",t).live("click",function(){var e=$(this).data("name");return $('input[name="'+e+'"]').val("-1"),$("."+e+" .iframe_uploader_preview").html('<div class="image">Изображение удалено</div>'),!1})}),$(document).ready(function(){$(".radio_list.custom").each(function(e,t){$("label",t).each(function(e,s){$('input[type="radio"]',s).each(function(e,o){$(o).attr("checked")&&($("label",t).removeClass("checked"),$(s).addClass("checked")),$(o).click(function(){$(o).attr("checked")&&($("label",t).removeClass("checked"),$(s).addClass("checked"))})})})}),$("textarea[maxlength], input[maxlength]").each(function(e,t){if($(t).data("nocount")!==!0){var s=$(this).parents(".item"),t=$(t),o=$('<div class="count" title="Доступное количество символов для ввода">'+t.attr("maxlength")+"</div>");s.append(o),o.text(t.attr("maxlength")-t.val().length),t.bind("keyup blur focus change",function(){o.text(t.attr("maxlength")-t.val().length)})}})}),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports={RecaptchaOptions:RecaptchaOptions,check_progress:check_progress,show_uploader:show_uploader}),$(function(){$.getJSON("https://habrahabr.ru/hauusbx/toplink/",function(e){var t="";if(e.links.length)$.each(e.links,function(e,s){var o=s.color?'style="color: '+s.color+'"':"";t+='<a href="'+s.link+'" target="_blank" '+o+">"+s.title+"</a>"});else{if(!e.link||!e.title)return;var s=e.color?'style="color: '+e.color+'"':"";t='<a href="'+e.link+'" target="_blank" '+s+">"+e.title+"</a>"}$("#TMpanel .slink").html(t)}),window.TMPanelShowLink=function(e){var t=e.color?'style="color: '+e.color+'"':"",s='<a href="'+e.link+'" target="_blank" '+t+">"+e.title+"</a>";"left"===e.position?$("#TMpanel .slink").prepend(s):$("#TMpanel .slink").append(s)},"undefined"!=typeof adriver&&new adriver("adriver_banner_465568687",{sid:210194,bt:52,bn:1})}),$(document).ready(function(){function e(){var e=n.find("input"),t={};return e.each(function(e){t[this.name]=this.checked}),t}function t(){var t=e(),o=0,a=r.data("posts-count");return r.find("li").each(function(e){var s=$(this),n=s.attr("data-type");t[n]&&o<a?(o++,s.removeClass("hidden"),s.addClass("visible")):s.addClass("hidden")}),s()}function s(){var e=n.find("input"),t=n.find("input:checked").length;return t<=1?n.find("input:checked").prop("disabled",!0):e.prop("disabled",!1),!1}function o(){var t=e();$.jStorage.set(i,t)}function a(){var s=$.jStorage.get(i,e());n.find("input").each(function(){var e=$(this),t=e.attr("name");e.prop("checked",s[t])}),t()}var n=$("#filter"),r=$("#list"),i="__checkedCheckboxes";
$(document).on("ready",a),$(document).on("change","#filter input",t),$(document).on("change","#filter input",s),$(document).on("change","#filter input",o)}),$(document).ready(function(){var e=".daily_best_posts";$(".corporate_blog").length&&(e=".corporate_blog"),$(e).length&&show_float_block(e)}),$(document).ready(function(){if($(".post_full .content > :header[id]").each(function(){$(this).append('<a class="title_anchor" href="#'+$(this).attr("id")+'"></a>')}),$(".post_teaser .content > :header[id]").each(function(){var e=$(this).closest(".post_teaser").find(".post__title_link"),t=e.attr("href");$(this).append('<a class="title_anchor" href="'+t+"#"+$(this).attr("id")+'"></a>')}),$(".js-cause-toggle").on("click",function(){$("#admin_causes").toggleClass("hidden")}),$(".js-abuse_form").size()>0){$(".js-abuse").on("click",function(){var e=$(this).closest(".abuse");e.addClass("abuse_huge"),$(".js-abuse_form",e).removeClass("hidden"),$(".js-abuse",e).addClass("hidden"),$(".js-abuse_cancel",e).removeClass("hidden"),$('input[name="text"]',e).focus()}),$(".js-abuse_cancel").on("click",function(){var e=$(this).closest(".abuse");e.removeClass("abuse_huge"),$(".js-abuse_form",e).addClass("hidden"),$(".js-abuse",e).removeClass("hidden"),$(".js-abuse_cancel",e).addClass("hidden")});var e=$('#abuse_form input[name="text"]');e.on("change keyup",function(){""===$(this).val()?$('#abuse_form button[type="submit"]').attr("disabled",!0):$('#abuse_form button[type="submit"]').attr("disabled",!1)}),$("#abuse_form").ajaxForm({form:$("#abuse_form"),beforeSubmit:function(e,t,s){ajaxFormBeforSubmit(e,t,s);var o=$('#abuse_form input[name="text"]').val(),a=/\s+/g;if(o=o.replace(a,""),$('#abuse_form button[type="submit"]').attr("disabled",!0),""===o)return!1},success:ajaxFormSuccess(function(e,t,s,o){$.jGrowl("Спасибо, жалоба отправлена.",{}),$("#abuse_form").resetForm(),$('#abuse_form button[type="submit"]').attr("disabled",!0),$(".js-abuse_cancel").click()},!1,!0)})}$("#edit_tags_form .tags_string").autocomplete({serviceUrl:"/json/suggest/",minChars:2,delimiter:/(,|;)\s*/,maxHeight:400,width:300,zIndex:9999,deferRequestBy:500,params:{type:"tags"}}),$("#edit_tags_form").size()&&$("#edit_tags_form").ajaxForm({form:$("#edit_tags_form"),beforeSubmit:ajaxFormBeforSubmit,success:ajaxFormSuccess(function(e,t,s,o){var a=$("#edit_tags_form"),n=$('input[name="ti"]',a).val();$('input[name="tt"]',a).val();$("#post_"+n+" .tags li.fav").remove();for(k in e.user_tags)$("#post_"+n+" .tags .favourites_edit_tags").before('<li class="fav">, <a rel="tag" href="/tag/'+e.user_tags[k]+'/">'+e.user_tags[k]+"</a></li>");$("#edit_tags_form").hide()})}),$("#lenta_notifications .close").click(function(){return $("#lenta_notifications").fadeOut(),$.post("/json/notifications/hint_get_more_blogs/",function(e){"ok"==e.messages||show_system_error(e)},"json"),!1}),$(".js-add_company_member").on("click",function(){var e=$(this),t=e.data("company_id");$.post("/json/corporation/fan_add/",{company_id:t},function(e){"ok"==e.messages?($("#company_"+t+" .js-remove_company_member").removeClass("hidden"),$("#company_"+t+" .js-add_company_member").addClass("hidden")):show_system_error(e)},"json")}),$(".js-remove_company_member").on("click",function(){var e=$(this),t=e.data("company_id");$.post("/json/corporation/fan_del/",{company_id:t},function(e){"ok"==e.messages?($("#company_"+t+" .js-remove_company_member").addClass("hidden"),$("#company_"+t+" .js-add_company_member").removeClass("hidden")):show_system_error(e)},"json")})}),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports={change_post_subscibptions_checkboxes:change_post_subscibptions_checkboxes,close_edit_tags:close_edit_tags,posts_add_to_favorite:posts_add_to_favorite,posts_poll:posts_poll,posts_vote:posts_vote,show_edit_tags:show_edit_tags}),$(function(){mention_autocomplete($("#comment_text"))}),document.unreadcomments=[],$(document).ready(function(){$("*[rel=user-popover]").each(function(){var e=$(this);e.webuiPopover({animation:"fade",arrow:!1,padding:!1,placement:"bottom-right",trigger:"hover",offsetTop:5,delay:{show:1e3},type:"async",url:"/json/users/info/",async:{method:"POST",data:{login:e.data("user-login")}},content:function(e){var t=e.html;return t}})});var clicked=!1;$("#hide_all_deleted_comments").on("click",function(){var e=clicked?"Скрыть удаленные комментарии":"Показать удаленные комментарии";return clicked=!clicked,$("#hide_all_deleted_comments").text(e),$(".comment_item .info.deleted").each(function(){$(this).closest(".comment_item").toggle()}),!1}),$(".comment_item .bad").on("touchstart",function(){$(this).toggleClass("focused")}),$(document).on("click",".comment_item .html_format a",function(){$(this).attr("target","_blank")}),$(document).on("click",".comment-moderate",function(){var e=$(this).data("id"),t=$(this).data("action"),s=$(this);return s.addClass("loading"),$.post("/json/comment/",{id:e,action:"moderate",status:t},function(o){if("approve"==t)if("ok"==o.messages){var a;for(a in o.comments)0==$("#comment_"+o.comments[a].id).size()&&(0==o.comments[a].parent_id?$("#comment_"+e).replaceWith(o.comments[a].html):$("#reply_comments_"+o.comments[a].parent_id).find("#comment_"+e).replaceWith(o.comments[a].html),show_comment_parents(o.comments[a].id),document.unreadcomments.push({id:parseInt(o.comments[a].id)}));var n=$("#xpanel .new");if(n){var r=$(".comment_item .is_new").size();r>0&&n.text(r).show()}var i=$("#comments_count");i.text(parseInt($("#comments_count").text())+o.comments.length),$("pre code").each(function(){hljs.highlightBlock(this)}),change_post_subscibptions_checkboxes(o),instagrammProcess()}else show_system_error(o);else"ok"==o.messages?$("#comment_"+e).remove():show_system_error(o);s.removeClass("loading")},"json"),!1}),$(document).on("click",".js-hide_placeholder",function(e){e.preventDefault(),$("#moderated_placeholder").addClass("hidden"),$("#expired_placeholder").addClass("hidden"),comment_show_form()}),$(document).on("click",".js-hide_author-placeholder",function(e){var t=$(this).closest(".js-author-placeholder"),s=$(this).data("user-id"),o=$(this).data("url");e.preventDefault(),t.fadeOut("400"),$.post(o,{user_id:s})}),$("#comment_markdown").on("change",function(){var e=$(this),t=e.attr("checked")?"1":"0";$.post("/json/comment/markdown/",{action:"markdown",state:t})}),$(".comment_item .abuse_link").on("click",function(){var e=$(this),t=window.confirm("Вы уверены, что хотите пожаловаться на комментарий?"),s={tt:$(this).data("tt"),ti:$(this).data("ti")};return t&&$.post($(this).data("url"),s,function(t){"ok"==t.messages?e.replaceWith('<span class="abuse_success">спасибо, жалоба отправлена</span>'):show_form_errors(t)}),!1}),$(document).on("click",".js-comment_parent",function(){var e=$(this).data("parent_id"),t=$(this).data("id");return $.scrollTo($("#comment_"+e),800,{axis:"y",offset:-10}),$(this).hasClass("back_to_children")?$("#comment_"+t+" > .comment_body > .info .js-comment_chidren").html(""):$("#comment_"+e+" > .comment_body > .info .js-comment_chidren").html('<a href="#comment_'+t+'" data-id="'+e+'" data-parent_id="'+t+'" class="icon_comment-children js-comment_parent back_to_children" title="Вернуться к ответу"></a>'),!1}),$(".js-comment_tree").on("click",function(){var e=$(this).data("id");$(this).hasClass("open")?($(".comment_item").show(),$(".comment_item .js-comment_tree").removeClass("open")):($(".comment_item").hide(),$(this).addClass("open"),show_comment_parents(e)),$.scrollTo($("#comment_"+e),1,{axis:"y",offset:{top:-1*($(window).height()/2)}})});var comments_form=$("#comments_form"),comment_text=$("#comment_text");if(comment_text.live("keyup change blur focus",function(e){empty($(this).val())?$("input.disableble",comments_form).attr("disabled",!0):$("input.disableble",comments_form).attr("disabled",!1)}),getQueryVariable("reply_to")){var comment_id=getQueryVariable("reply_to");comment_show_reply_form(comment_id)}if(g_is_guest&&($("#subscribe_comments").change(function(){var subscribe_checkbox=$(this);eval("var data = "+subscribe_checkbox.attr("rel")+";"),data.action=subscribe_checkbox.attr("checked")?"subscribe":"unsubscribe",$.post("/json/subscription/",data,function(e){"ok"==e.messages?$.jGrowl("Настройки уведомления о новых комментариях успешно сохранены",{theme:"notice"}):show_system_error(e)},"json")}),$("#tracker_comments").change(function(){var checkbox=$(this);eval("var data = "+checkbox.attr("rel")+";");var url=checkbox.attr("checked")?"/json/tracker/add/":"/json/tracker/remove/";$.post(url,data,function(e){"ok"==e.messages?$.jGrowl("Настройки уведомления о новых комментариях успешно сохранены",{theme:"notice"}):show_system_error(e)},"json")})),g_show_xpanel){var xpanel=$('<div id="xpanel"></div>'),new_comments_count=$(".comment_item .is_new").length,new_counter=$('<a href="#new" class="new" title="Количество новых комментариев. По клику (горячая клавиша - f) переходит к первому непрочитанному комментарию.">'+new_comments_count+"</a>");new_counter.on("click",xpanel_new_counter_click);var refresh_button=$('<a href="#refresh" class="refresh"></a>');refresh_button.on("click",xpanel_refresh_button_click);var prev_new_button=$('<a href="#prev_new" class="prev_new" title="По клику (горячая клавиша - k) переходит к предыдущему непрочитанному комментарию.">&uarr;</a>');prev_new_button.on("click",xpanel_prev_new_button_click);var next_new_button=$('<a href="#next_new" class="next_new" title="По клику (горячая клавиша - j) переходит к следующему непрочитанному комментарию.">&darr;</a>');next_new_button.on("click",xpanel_next_new_button_click),xpanel.append(refresh_button),xpanel.append(prev_new_button),xpanel.append(new_counter),xpanel.append(next_new_button),$("body").append(xpanel),0==new_comments_count&&(prev_new_button.hide(),next_new_button.hide(),new_counter.hide())}}),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports={comment_delete:comment_delete,comment_preview:comment_preview,comment_send:comment_send,comment_show_edit_form:comment_show_edit_form,comment_show_form:comment_show_form,comment_show_reply_form:comment_show_reply_form,comment_update:comment_update,comments_add_to_favorite:comments_add_to_favorite,comments_vote:comments_vote,getQueryVariable:getQueryVariable,instagrammProcess:instagrammProcess,removeFromArray:removeFromArray,show_comment_parents:show_comment_parents,xpanel_new_counter_click:xpanel_new_counter_click,xpanel_next_new_button_click:xpanel_next_new_button_click,xpanel_prev_new_button_click:xpanel_prev_new_button_click,xpanel_refresh_button_click:xpanel_refresh_button_click}),$(document).ready(function(){if($("#adriver_banner_1109509440").length){var e=function(){var t=$("#adriver_banner_1109509440");scrollTop=$(window).scrollTop(),scrollBottom=$(window).scrollTop()+$(window).height(),blockTopPosition=t.parent().offset().top,adBannerHeight=t.height(),scrollBottom>blockTopPosition&&(loadAdriverBanner(),$(window).off("scroll",e))};$(window).on("ready",e),$(window).on("scroll",e)}});var openSearch,closeSearch;!function(){var e=document.getElementById("search-form"),t=document.getElementById("search-form-btn"),s=document.getElementById("search-form-field"),o=(document.getElementById("search-form-clear"),document.getElementById("navbar-links"));t.onclick=function(e){e.preventDefault(),openSearch()},s.onblur=function(){closeSearch()},s.onfocus=function(e){document.onkeydown=function(e){e=e||window.event,27==e.which&&closeSearch()}},openSearch=function(){e.className+=" search-form_expanded",o.className+=" hidden",s.focus()},closeSearch=function(){s.value="",s.blur(),e.classList.remove("search-form_expanded"),o.classList.remove("hidden")}}(),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports={closeSearch:closeSearch,openSearch:openSearch}),$(document).ready(function(){$('#search_form input[type="text"]').autocomplete({serviceUrl:"/json/suggest/",minChars:2,delimiter:/(,|;)\s*/,maxHeight:400,width:300,zIndex:9999,deferRequestBy:500,params:{type:"search"}})}),$(document).ready(function(){function e(e){var s=$.cookie(e);return s?s:(s=t(),$.cookie(e,s,{expires:14,path:"/"}),s)}function t(){var e=["A","B"],t=s(0,1);return e[t]}function s(e,t){return Math.floor(Math.random()*(t-e+1))+e}var o=e("ab_test_vacancies_block_group");$(".promo-block_vacancies a").each(function(){var e=$(this),t=e.data("utm"),s="utm_campaign=tm_promo",a="utm_campaign=tm_promo_"+o,n=t.replace(s,a);e.data("utm",n),e.attr("data-utm",n)})});var _H=window._H||{};$(document).ready(function(){"use strict";new _H.Suggest({selectors:{clear:"#hubs_suggest_clear",container:"#hubs",suggest:"#hubs_suggest",follow:".js-hub-follow-btn"},suggestUrl:"/json/hubs/",suggestRequest:function(e){return{hub_id:$(e).attr("data-id")}}})}),$(document).ready(function(){var e=$.jStorage.get("last_navigator_category"),t=$.jStorage.get("last_navigator_hubs"),s=$.jStorage.get("last_navigator_hub");if(e&&"null"!=e){if($('#fast_navagator select[name="category"]').val(e),t){var o="";for(k in t)o+='<option value="'+t[k].alias+'">'+t[k].name+"</option>";$('#fast_navagator select[name="hub"]').html(o).attr("disabled",!1),$('#fast_navagator input[type="submit"]').attr("disabled",!1)}s&&($('#fast_navagator select[name="hub"]').val(s),$("#fast_navagator .buttons input").attr("disabled",!1).removeClass("loading"))}else $('#fast_navagator select[name="hub"]').html("<option>Хаб</option>").attr("disabled",!0),$('#fast_navagator input[type="submit"]').attr("disabled",!0);$('#fast_navagator select[name="category"]').change(function(){var e=$(this).val();$.jStorage.set("last_navigator_category",e),"null"==e?($('#fast_navagator select[name="hub"]').html("<option>Хаб</option>").attr("disabled",!0),$('#fast_navagator input[type="submit"]').attr("disabled",!0)):$.post("/json/hubs/category/"+e+"/",function(e){if("ok"==e.messages){var t="";for(k in e.hubs)t+='<option value="'+e.hubs[k].alias+'">'+e.hubs[k].name+"</option>";$.jStorage.set("last_navigator_hubs",e.hubs),$('#fast_navagator select[name="hub"]').html(t).attr("disabled",!1),$('#fast_navagator input[type="submit"]').attr("disabled",!1)}else show_system_error(e)},"json")}),$("#fast_navagator").submit(function(){var e=$('#fast_navagator select[name="hub"]').val();return $.jStorage.set("last_navigator_hub",e),document.location.href="/hub/"+e+"/",!1}),$("#addCompanyFan").click(function(){var e=$(this).attr("data-id"),t=$(this);return t.addClass("loading"),$.post("/json/corporation/fan_add/",{company_id:e},function(e){"ok"==e.messages?($("#removeCompanyFan").removeClass("hidden"),$("#addCompanyFan").addClass("hidden"),$("#fans_count").text(e.fans_count_str)):show_system_error(e),t.removeClass("loading")},"json"),!1}),$("#removeCompanyFan").click(function(){var e=$(this).attr("data-id"),t=$(this);return t.addClass("loading"),$.post("/json/corporation/fan_del/",{company_id:e},function(e){"ok"==e.messages?($("#removeCompanyFan").addClass("hidden"),$("#addCompanyFan").removeClass("hidden"),$("#fans_count").text(e.fans_count_str)):show_system_error(e),t.removeClass("loading")},"json"),!1})}),$(document).ready(function(){$('.post .infopanel input[name="send_invite"]').live("click",function(){var e=$(this).data("id");return $.post("/json/users/give_invite_bypost/",{post_id:e},function(t){"ok"==t.messages?$("#infopanel_post_"+e+" .send_invite_wrapper").html('<span style="color:green;">Приглашение отправлено</span>'):show_system_error(t)},"json"),!1}),$('.post .infopanel input[name="send_invite_plus"]').live("click",function(){var e=$(this).data("id");return $.post("/json/users/give_invite_bypost_plus/",{post_id:e},function(t){"ok"==t.messages?$("#infopanel_post_"+e+" .send_invite_wrapper").html('<span style="color:green;">Приглашение отправлено</span>'):show_system_error(t)},"json"),!1}),$('.post .infopanel input[name="delete"]').live("click",function(){var e=$(this).data("id");return $.post("/json/sandbox/delete/",{post_id:e},function(t){"ok"==t.messages?$("#post_"+e).fadeOut(500,function(){$(this).remove()}):show_system_error(t)},"json"),!1}),$('.post .infopanel input[name="reject"]').live("click",function(){var e=$(this).data("id");$("#reject_form_post_"+e).removeClass("hidden"),$("#transfer_form_post_"+e).addClass("hidden");var t=$("#reject_form_post_"+e+' select[name="reject_reason"]');return t.attr("enabled","true"),$.each(reasonsList,function(){t.append($("<option></option>").text(this.optionValue).val(this.optionValue).attr({"data-text":this.textareaValue,"data-action":this.action}))}),!1}),$(document).on("change",'.reject_form select[name="reject_reason"]',function(e){var t=$(this).closest(".reject_form").data("id"),s=this.options[e.target.selectedIndex],o=$(s).data("text"),a=$(s).data("action");$("#reject_form_post_"+t).find("#reject_text_textarea").val(o),$("#reject_form_post_"+t).find('input[name="reject_action"]').val(a),""===a&&$("#reject_form_post_"+t+" .reject_reason").find(".error").text("Вы не выбрали причину отклонения публикации!")}),$('.post .infopanel input[name="transfer"]').live("click",function(){var e=$(this).data("id");return $("#reject_form_post_"+e).addClass("hidden"),$("#transfer_form_post_"+e).removeClass("hidden"),!1}),$('.post .infopanel input[name="publish"]').live("click",function(){var e=$(this).data("id");return $.post("/json/sandbox/publish/",{post_id:e},function(t){"ok"==t.messages?$("#post_"+e).fadeOut(500,function(){$(this).remove()}):show_system_error(t)},"json"),!1})}),$(function(){if(!$("#habralenta-settings").length)return!1;var e=$('<img src="/images/form/ajax_loader.gif" alt="" class="ajax_loader" align="top"/>'),t=$("#hubs_category"),s=($("#habralenta-settings"),$("#form_habralenta_settings"),$("#save_success"),""),o=hubs_category_json;$.each(o.categories,function(e,t){var a=2==t.subscription?"full":"",n=1==t.subscription?"part":"",r=2==t.subscription?"Отписаться от всех хабов в этом потоке":"Подписаться на все хабы в этом потоке",i="corporative_blogs"==t.alias?"/companies/":"/hubs/"+t.alias+"/",c=o.lenta_show_all||0==t.count?"disabled":"",l=t.have_new?' <span class="new">'+t.have_new+"</span>":"",d=t.count>0?'<a href="'+i+'" title="Нажмите, чтобы посмотреть хабы из этого потока">'+t.name+"</a>":'<span class="category_title">'+t.name+"</span>";s+='<div class="category '+a+" "+n+" "+c+'" data-alias="'+t.alias+'">                       <div class="checkbox" title="'+r+'"></div>                       <input type="hidden" name="categories['+t.alias+']" class="input" value="'+t.subscription+'" />                       <div class="title">                         '+d+'                         <span class="count" title="Количество хабов в категории">('+t.count+")</span>                         "+l+'                       </div>                       <div class="hubs"></div>                     </div>'}),t.html(s),$(".lenta-tip").tipTip({maxWidth:"300",edgeOffset:10}),"undefined"!=typeof o.subscription&&o.subscription&&($('input[name="enable_subscription"]').prop("checked",!0),$('select[name="subscription_frequency"]').val(o.subscription.frequency)),$(".category .title a",t).live("click",function(){var t=$(this),s=t.parent().parent(".category"),o=$(".hubs",s),a=$(".title .count",s),n=s.attr("data-alias");return!s.hasClass("disabled")&&(o.html()?o.toggleClass("show"):(a.after(e),$.get("/json/hubs/category/"+n+"/",function(t){var a="";$.each(t.hubs,function(e,t){s.hasClass("full")?t.subscription=1:s.hasClass("part")||(t.subscription=0);var o=t.subscription?"subscription":"",r=t.subscription?"Отписаться от хаба":"Подписаться на хаб",i="corporative_blogs"==n?"/company/"+t.alias+"/blog/":"/hub/"+t.alias+"/",c=t.is_new?' <span class="new">новый</span>':"";a+='<div class="hub '+o+'">                         <div class="checkbox" title="'+r+'"></div>                         <input type="hidden" name="blogs['+t.id+']" class="input" value="'+t.subscription+'" />                         <a href="'+i+'" target="_blank">'+t.name+"</a>                         "+c+"                       </div>"}),e.remove(),o.html(a),o.toggleClass("show"),$(".hub a",o).click(function(){var e=$(this),t=e.parent(".hub"),s=t.parent().parent(".category");if(s.hasClass("disabled"))return!1}),$(".hub .checkbox",o).on("click",function(e){e.preventDefault();var t=$(this),s=t.parent(".hub"),a=s.parent().parent(".category"),n=$(".input",s),r=$("> .input",a);if(a.hasClass("disabled"))return!1;s.hasClass("subscription")?(s.removeClass("subscription"),n.val(0),t.attr("title","Подписаться на хаб")):(s.addClass("subscription"),n.val(1),t.attr("title","Отписаться от хаба"));var i=$(".subscription",o),c=$(".hub",o);0==i.size()?(a.removeClass("part").removeClass("full"),r.val(0),a.find("> .checkbox").attr("title","Подписаться на все хабы в этой категории")):i.size()==c.size()?(a.removeClass("part").addClass("full"),r.val(2),a.find("> .checkbox").attr("title","Отписаться от всех хабов в этой категории")):(a.removeClass("full").addClass("part"),r.val(1),a.find("> .checkbox").attr("title","Подписаться на все хабы в этой категории"))})},"json")),!1)}),$(".category > .checkbox",t).live("click",function(){var e=$(this),t=e.parent(".category"),s=(t.attr("data-alias"),$(".hubs",t)),o=$(".input",t);return!t.hasClass("disabled")&&(t.hasClass("full")?(t.removeClass("full").removeClass("part"),o.val(0),$(".hub",s).removeClass("subscription"),$(".hub .input",s).val(0),e.attr("title","Подписаться на все хабы в этой категории")):t.hasClass("part")?(t.removeClass("part").addClass("full"),o.val(2),$(".hub",s).addClass("subscription"),$(".hub .input",s).val(1),e.attr("title","Отписаться от всех хабов в этой категории")):(t.addClass("full"),o.val(2),$(".hub",s).addClass("subscription"),$(".hub .input",s).val(1),e.attr("title","Отписаться от всех хабов в этой категории")),!1)}),$("#form_habralenta_settings").ajaxForm({form:$("#form_habralenta_settings"),url:"/json/hubs/save_subscriptions/",beforeSubmit:ajaxFormBeforSubmit,error:ajaxFormError,success:ajaxFormSuccess(function(e,t,s,o){$.jGrowl("Настройки ленты успешно сохранились")})})}),$(document).ready(function(){$("#give_invite_button").click(function(){var e=$(this).data("login");return $.post("/json/users/send_invite/",{login:e},function(e){"ok"==e.messages?($.jGrowl("Вы подарили приглашение.<br> У вас осталось "+e.invites_string+".",{theme:"notice"}),ajaxFormRedirect(e)):show_system_error(e)}),!1}),$("#send_invite").click(function(){var e=$(this).data("user_id");return $.post("/json/users/set_invite/",{user_id:e},function(e){"ok"==e.messages?$.jGrowl("Приглашение отправлено",{theme:"notice"}):show_system_error(e)},"json"),!1}),$("#go_ppg").click(function(){var e=$(this).data("user_id");return $.post("/json/users/ppg_comments/",{user_id:e},function(e){"ok"==e.messages?$.jGrowl("Пользователь отправлен на ППГ",{theme:"notice"}):show_system_error(e)},"json"),!1}),$("#go_pis").click(function(){var e=$(this).data("user_id");return $.post("/json/users/ppg_smiles/",{user_id:e},function(e){"ok"==e.messages?$.jGrowl("Пользователь отправлен на ПИС",{theme:"notice"}):show_system_error(e)},"json"),!1})}),$(document).ready(function(){var e=function(){function e(){n.removeClass("hidden"),$("#userNoteFormTextarea").focus(),""!=s()&&$(".js-saveUserNote").attr("disabled",!1)}function t(e){var t=""!=e?"сохранена":"удалена",s="Заметка успешно  "+t;return $.jGrowl(s,{theme:"notice"})}function s(){return $("#userNoteFormTextarea").val()}function o(e){var s=e.note;"ok"==e.messages?(t(s),""!=s?(r.html(e.note),$(".js-userNote").removeClass("hidden"),n.addClass("hidden")):($(".js-noteBlockHeader").addClass("hidden"),$(".js-writeNoteBtn").removeClass("hidden"),n.addClass("hidden"))):window.show_system_error(e)}function a(){r.val()}var n=$(".js-userNoteForm"),r=$(".js-userNoteText");return{showForm:e,saveForm:o,clearForm:a,getValue:s}}();$(".js-writeNoteBtn").on("click",function(t){t.preventDefault(),$(this).addClass("hidden"),$(".js-noteBlockHeader").removeClass("hidden"),e.showForm()}),$(".js-editNoteBtn").on("click",function(t){t.preventDefault(),$(".js-userNote").addClass("hidden"),$(".js-cancelNoteBtn").addClass("hidden"),$(".js-userNoteForm").addClass("edit-mode"),e.showForm()}),$(".js-cancelNoteBtn").on("click",function(e){e.preventDefault(),$(".js-writeNoteBtn").removeClass("hidden"),$(".js-noteBlockHeader").addClass("hidden"),$(".js-userNoteForm").addClass("hidden"),$("#userNoteFormTextarea").val("").blur()}),$(".js-userNoteForm").on("change keyup",function(){var t=$(".js-saveUserNote");t.attr("disabled",!0),(""!=e.getValue()||$(".js-userNoteForm").hasClass("edit-mode"))&&t.attr("disabled",!1)}),$(".js-userNoteForm").ajaxForm({dataType:"json",url:"/json/users/save_note/",beforeSubmit:function(){e.clearForm()},success:function(t){e.saveForm(t)}}),$(".showmore_items").on("click",function(e){e.preventDefault();var t=($(this).data("login"),$(this).data("type"));$("#"+t+"_items li.hidden").removeClass("hidden"),$(this).remove()}),$("*[rel=hub-popover]").each(function(){var e=$(this);e.webuiPopover({animation:"fade",arrow:!1,padding:!1,placement:"bottom-right",trigger:"hover",offsetTop:5,delay:{show:1e3},type:"async",url:"/json/hubs/info/",async:{method:"POST",data:{alias:e.data("hub-alias")}},content:function(e){var t=e.html;return t}})})}),$(document).ready(function(){$("#invite_form").ajaxForm({dataType:"json",url:"/json/users/give_invite_byform/",beforeSubmit:function(){$('#invite_form input[type="submit"]').addClass("loading")},success:function(e){"ok"==e.messages?($.jGrowl("Приглашение отправлено",{theme:"notice"}),$("#count_invite").text(e.invite_string),$(".used_invites").prepend('<div class="invite_item" id="invite_item_'+e.invite_id+'">                <img src="/register/icode/'+e.invite_code+'/"  alt="" />                <a href="mailto:'+e.to_email+'">'+e.to_email+'</a>                <a href="#cancel" class="cancel" title="Отозвать приглашение" data-id="'+e.invite_id+'">x</a>            </div>'),$("#invite_form").resetForm()):show_system_error(e),$('#invite_form input[type="submit"]').removeClass("loading")}}),$("img.invite_preloader").live("click",function(){return $(this).attr("src",$(this).data("invite_url")).removeClass("invite_preloader").attr("title",""),!1}),$(".resend_invite").live("click",function(){var e=$(this),t=e.data("code");return $.post("/json/users/send_invite_notification/",{code:t},function(t){"ok"==t.messages?e.replaceWith("Приглашение повторно отправлено"):show_system_error(t)}),!1}),$(".used_invites .invite_item .cancel").live("click",function(){var e=$(this).data("id");return $.post("/json/users/unset_invites/",{invite_id:e},function(t){"ok"==t.messages?($.jGrowl("Приглашение отозвано",{theme:"notice"}),$("#invite_item_"+e).remove(),$("#count_invite").text(t.invite_string)):show_system_error(t)},"json"),!1})}),$(document).ready(function(){$("#karma_reset_input").click(function(){var e=!$(this).attr("checked");$('#karma_reset_form input[type="submit"]').attr("disabled",e)}),$("#karma_reset_form").ajaxForm({dataType:"json",url:"/json/users/reset/request/",beforeSubmit:function(){$('#karma_reset_form input[type="submit"]').addClass("loading")},success:function(e){"ok"==e.messages?$("#karma_reset").removeClass("karma_reseting").addClass("karma_noreseting"):show_system_error(e),$('#karma_reset_form input[type="submit"]').removeClass("loading")}}),$("#karma_reset_abort_form").ajaxForm({dataType:"json",url:"/json/users/reset/abort/",beforeSubmit:function(){$('#karma_reset_abort_form input[type="submit"]').addClass("loading")},success:function(e){"ok"==e.messages?$("#karma_reset").addClass("karma_reseting").removeClass("karma_noreseting"):show_system_error(e),$('#karma_reset_abort_form input[type="submit"]').removeClass("loading")}})});var _H=window._H||{};_H.Suggest=function(e){"use strict";var t=this.validateSettings(e);t&&(this._settings=e,this._clearButton=null,this._suggestElement=null,this._suggestWrapper=null,this._debounceTimer=!1,this._value="",this.init())},_H.Suggest.prototype.validateSettings=function(e){return!!e.selectors&&(!!(e.selectors.clear&&e.selectors.container&&e.selectors.suggest&&e.selectors.follow)&&(!!e.suggestUrl&&"function"==typeof e.suggestRequest))},_H.Suggest.prototype.init=function(){"use strict";this._suggestElement=$(this._settings.selectors.suggest),this._suggestWrapper=this._suggestElement.parent(),this._clearButton=$(this._settings.selectors.clear);var e=$(this._settings.selectors.container);this._fuzzySearch=window.fuzzySearch(this._suggestElement,e),this._clearButton.on("click",$.proxy(this.onClearClick,this)),this._suggestElement.on("change keyup",$.proxy(this.onElementChange,this)),$(document).on("click",this._settings.selectors.follow,$.proxy(this.onFollowButtonClick,this))},_H.Suggest.prototype.onClearClick=function(){"use strict";this.clear()},_H.Suggest.prototype.onElementChange=function(e){"use strict";var t=e.charCode||e.keyCode,s=27===t;s&&this.clear();var o=this._suggestElement.val();this._value!==o&&(this._value=o,this.enableLoadingState(!0),this.enableFilledState(!1),this._debounce($.proxy(function(){this.fetchResults(o)},this)))},_H.Suggest.prototype.clear=function(){"use strict";this._suggestElement.val(""),this._suggestElement.trigger("change"),this.enableFilledState(!1)},_H.Suggest.prototype._debounce=function(e){"use strict";this._debounceTimer&&clearTimeout(this._debounceTimer),this._debounceTimer=setTimeout($.proxy(e,this),300)},_H.Suggest.prototype.fetchResults=function(){"use strict";this._value?this._fuzzySearch.fetch(this._value,$.proxy(function(){this.enableLoadingState(!1),this.enableFilledState(!0)},this)):(this._fuzzySearch.reset(),this.enableFilledState(!1),this.enableLoadingState(!1))},_H.Suggest.prototype.onFollowButtonClick=function(e){"use strict";var t=e.currentTarget;this.followUserByButton(t)},_H.Suggest.prototype.followUserByButton=function(e){"use strict";var t=this._settings.suggestUrl,s=this._settings.suggestRequest(e);window.btnFollow($(e),t,s)},_H.Suggest.prototype.enableLoadingState=function(e){this._suggestWrapper.toggleClass("loading",e)},_H.Suggest.prototype.enableFilledState=function(e){this._suggestWrapper.toggleClass("filled",e)},"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=_H.Suggest);var _H=window._H||{};$(document).ready(function(){"use strict";new _H.Suggest({selectors:{clear:"#people_suggest_clear",container:"#peoples",suggest:"#people_suggest",follow:".js-user-follow-btn"},suggestUrl:"/json/users/",suggestRequest:function(e){return{login:$(e).attr("data-login")}}})}),$(document).ready(function(){$("#i_work_in_company").click(function(){var e=$(this),t=$(this).data("id"),s=$("#js-companyWorkersCount"),o=$("#js-companyWorkersList");e.attr("checked")?$.post("/json/corporation/worker_add/",{company_id:t},function(t){"ok"==t.messages?(e.attr("title","Уволиться из компании"),$.jGrowl("Вы работаете в этой компании"),s.text(parseInt(s.text())+1),o.append('<li><a href="http://'+g_user_login+"."+g_base_url+'/" class="you">'+g_user_login+"</a></li>")):show_system_error(t)},"json"):$.post("/json/corporation/worker_del/",{company_id:t},function(t){"ok"==t.messages?(e.attr("title","Я работаю в этой компании"),$.jGrowl("Вы не работаете в этой компании"),s.text(parseInt(s.text())-1),$(".you",o).remove()):show_system_error(t)},"json")})}),$(document).ready(function(){$("#add_director").click(function(){var e=$("#directors_list .row").size(),t=$('<div class="row directors_'+e+'" id="row_'+e+'">                <div class="td name"><input type="text" name="directors['+e+'][name]" value=""/></div>                <div class="td position"><input type="text" name="directors['+e+'][position]" value=""/></div>                <div class="td delete"><a href="#remove" data-id="'+e+'" class="dotted">удалить</a></div>                <div class="clear"></div>                <div class="error"></div>              </div>');return $("#directors_list").append(t),!1}),$("#directors_list .row .delete a").live("click",function(){var e=$(this).data("id");
return $("#row_"+e).html("").hide(),!1}),$("#add_stage").click(function(){var e=$("#stages_list .row").size()+1,t=$("#stage_select_date_template").html();t=t.replace(/NUM/g,e);var s=$('<div class="row" id="row_'+e+'">                <div class="td text"><input type="text" name="stages['+e+'][description]" value=""/></div>                <div class="td date">'+t+'</div>                <div class="td delete"><a href="#remove" data-id="'+e+'" class="dotted">удалить</a></div>              </div>');return $("#stages_list").append(s),!1}),$("#stages_list .row .delete a").live("click",function(){var e=$(this).data("id");return $("#row_"+e).html("").hide(),!1}),$("#company_add_form").ajaxForm({form:$("#company_add_form"),beforeSubmit:ajaxFormBeforSubmit,error:ajaxFormError,success:ajaxFormSuccess(ajaxFormRedirect)}),$("#startup_add_form").ajaxForm({beforeSubmit:ajaxFormBeforSubmit,error:ajaxFormError,success:ajaxFormSuccess(function(e){"ok"==e.messages&&($(".company_add").hide(),$(".result").show(),$("html, body").animate({scrollTop:$(".result").offset().top+"px"}))})})});var _H=window._H||{};$(document).ready(function(){"use strict";new _H.Suggest({selectors:{clear:"#companies_suggest_clear",container:"#companies",suggest:"#companies_suggest",follow:".js-company-follow-btn"},suggestUrl:"/json/corporation/",suggestRequest:function(e){return{company_id:$(e).attr("data-id")}}})}),$(document).ready(function(){var e=$("#conversation_form");e.ajaxForm({form:e,beforeSubmit:ajaxFormBeforSubmit,error:ajaxFormError,success:ajaxFormSuccess(function(e,t,s,o){var a=$(e.message_html);$("#messages").prepend(a),$("#conversation_form textarea").val(""),$("pre code",a).each(function(e,t){hljs.highlightBlock(t,"    ")}),$("#preview_placeholder").html("").addClass("hidden"),$(".item.captcha").addClass("hidden")},function(e,t,s,o){"undefined"!=typeof Recaptcha&&Recaptcha.reload(),$("#imgCaptcha").size()&&($("#imgCaptcha").attr("src","/core/captcha?"+Math.random()),$("#captcha").val(""))})}),$("textarea",e).live("keyup change blur focus",function(t){$(this).val().length>0?$("input",e).attr("disabled",!1):$("input",e).attr("disabled",!0)}),mention_autocomplete($("#conversation_form textarea")),$("input.preview").click(function(){e.ajaxSubmit({form:e,url:"/json/conversations/preview/",beforeSubmit:ajaxFormBeforSubmit,error:ajaxFormError,success:ajaxFormSuccess(function(e,t,s,o){var a=$(e.message_html);$("#preview_placeholder").html(a).removeClass("hidden"),$("pre code",a).each(function(e,t){hljs.highlightBlock(t,"    ")})})})}),$("#load_more").click(function(){var e=$(this);return e.addClass("loading"),$.post(e.data("url"),{conversation_id:e.data("id"),respondent:e.data("respondent"),offset:e.data("offset")},function(t){if("ok"==t.messages){for(k in t.items)if(0==$("#message_"+t.items[k].id).size()){var s=$(t.items[k].html);s.hide(),$("#messages ").append(s),s.fadeIn(500)}0!=t.has_more?e.data("offset",t.offset):e.remove()}else show_system_error(t);e.removeClass("loading")}),!1})}),$(document).ready(function(){var e,t,s=$("#conversations").html(),o=$("#conversations_suggest_textfield").val();$("#conversations_suggest_textfield").blur(function(){""==this.value&&(this.value=o,$(this).removeClass("focus"))}).focus(function(){this.value==o&&(this.value="",$(this).addClass("focus"))}),$("#conversations_suggest_textfield").keyup(function(){var o=$(".conversations_suggest");o.addClass("loading"),e=setTimeout(function(){var e=$("#conversations_suggest_textfield").val();""==e?($("#conversations").html(s),$(".page-nav").show(),t="",o.removeClass("loading")):t==e||(t=e,$.post("/json/suggest/?type=conversation",{query:e},function(e){"ok"==e.messages?($("#conversations").html(e.conversations),$(".page-nav").hide()):show_system_error(e),o.removeClass("loading")},"json"))},1500)}),$("#conversations .conversation .delete").live("click",function(){var e=$(this).data("id");return confirm("Вы уверены, что хотите удалить диалог?")&&$.post("/json/conversations/delete/",{conversation_id:e},function(t){"ok"==t.messages?$("#conversation_"+e).remove():show_system_error(t)}),!1})}),$(document).ready(function(){$('#feedback_form input[name="submit"]').click(function(){$("#feedback_form").ajaxForm({form:$("#feedback_form"),url:"/json/feedback/save/",beforeSubmit:function(e,t,s){return $("#preview_placeholder").html("").addClass("hidden"),ajaxFormBeforSubmit(e,t,s)},error:ajaxFormError,success:ajaxFormSuccess(function(e,t,s,o){$("#feedback_form").html('<div class="global_notify"><div class="inner_notice">Ваше сообщение отправлено. Сохраняйте терпение, в ближайшее время вы получите ответ.</div></div>')},function(e,t,s,o){"undefined"!=typeof Recaptcha&&Recaptcha.reload(),$("#imgCaptcha").size()&&($("#imgCaptcha").attr("src","/core/captcha?"+Math.random()),$("#captcha").val(""))})})})}),$(document).ready(function(){return!!$("#notifications_settings_form").length&&($("#notifications_settings_form").ajaxForm({dataType:"json",url:"/json/settings/notifications/ ",beforeSubmit:function(){$("#notifications_settings_form .error").text("").hide(),$('#notifications_settings_form input[type="submit"]').addClass("loading")},success:function(e){"ok"==e.messages?$.jGrowl("Новые настройки успешно сохранились"):(show_form_errors(e),$.scrollTo($("#notifications_settings_form"),800,{axis:"y"})),$('#notifications_settings_form input[type="submit"]').removeClass("loading")}}),void("undefined"!=typeof json.subscription&&json.subscription&&($('input[name="enable_subscription"]').prop("checked",!0),$('select[name="subscription_frequency"]').val(json.subscription.frequency))))}),$(document).ready(function(){$("#password_settings_form").ajaxForm({dataType:"json",url:"/json/settings/password/ ",beforeSubmit:function(){$("#password_settings_form .error").text("").hide(),$('#password_settings_form input[type="submit"]').addClass("loading")},success:function(e){"ok"==e.messages?$.jGrowl("Новые настройки успешно сохранились"):(show_form_errors(e),$.scrollTo($("#password_settings_form"),800,{axis:"y"})),$('#password_settings_form input[type="submit"]').removeClass("loading")}}),$("#email_settings_form").ajaxForm({dataType:"json",url:"/json/settings/email/",beforeSubmit:function(){$("#email_settings_form .error").text("").hide(),$('#email_settings_form input[type="submit"]').addClass("loading")},success:function(e){"ok"==e.messages?$.jGrowl("Новые настройки успешно сохранились"):(show_form_errors(e),$.scrollTo($("#email_settings_form"),800,{axis:"y"})),$('#email_settings_form input[type="submit"]').removeClass("loading")}})}),$(document).ready(function(){$("#other_settings_form").ajaxForm({form:$("#other_settings_form"),url:"/json/settings/others/",beforeSubmit:ajaxFormBeforSubmit,error:ajaxFormError,success:ajaxFormSuccess(function(e,t,s,o){$.jGrowl("Новые настройки успешно сохранились")})})}),$(document).ready(function(){$("#privacy_settings_form").ajaxForm({dataType:"json",url:"/json/settings/privacy/ ",beforeSubmit:function(){$("#privacy_settings_form .error").text("").hide(),$('#privacy_settings_form input[type="submit"]').addClass("loading")},success:function(e){"ok"==e.messages?$.jGrowl("Новые настройки успешно сохранились"):(show_form_errors(e),$.scrollTo($("#privacy_settings_form"),800,{axis:"y"})),$('#privacy_settings_form input[type="submit"]').removeClass("loading")}})}),$(document).ready(function(){$(document).on("click","#add_contact",function(){var e=$("#contacts_list .row").size()+1,t=$("#contact_select_date_template").html();t=t.replace(/NUM/g,e);var s=$('<div class="row contacts'+e+'" id="row_'+e+'">                <div class="td type">'+t+'</div>                <div class="td value"><input type="text" name="contacts['+e+'][value]" value=""/></div>                <div class="td checkbox"><input type="checkbox" class="js-contacts-show_on_post" name="contacts['+e+'][show_on_post]" title="Показывать в инфопанели на странице публикации"/></div>                <div class="td delete"><a href="#remove" data-id="'+e+'" class="dotted">удалить</a></div>                <div class="error"></div>              </div>');return $("#contacts_list").append(s),!1});var e=5;$(document).on("change","input.js-contacts-show_on_post",function(t){var s=$("input.js-contacts-show_on_post:checked").length;s>e&&(this.checked=!1)}),$("#contacts_list .row .delete a").live("click",function(){var e=$(this).data("id");return $("#contacts_list #row_"+e).html("").hide(),!1}),$("#contacts_list .row .type select").live("change",function(){var e=$(this).parents(".row");18==$(this).val()?$('<div class="row_description">Связь аккаунта на Хабрахабре с учётной записью в Google+ позволит вам числиться автором статей в поисковой выдаче.<br>Подробности читайте в <a href="http://habrahabr.ru/info/help/settings/#2google">справочном разделе</a>.</div>').appendTo(e):$(".row_description",e).remove()}),$("#profile_settings_form").ajaxForm({form:$("#profile_settings_form"),beforeSubmit:ajaxFormBeforSubmit,error:ajaxFormError,success:ajaxFormSuccess(function(e,t,s,o){$.jGrowl("Новые настройки успешно сохранились")})}),$("#avatar_settings_form").ajaxForm({form:$("#avatar_settings_form"),beforeSubmit:ajaxFormBeforSubmit,error:ajaxFormError,success:ajaxFormSuccess(function(e,t,s,o){$.jGrowl("Новые настройки успешно сохранились")})})}),$(document).ready(function(){$(".connect-service").each(function(e,t){$.post($(t).data("url"),{ajax:!0},function(e){e.id&&$(".about",t).html('<a href="'+e.link+'" class="pic"><img src="'+e.pic+'" alt="" /></a><a href="'+e.link+'" class="name">'+e.name+"</a>"),e.auth_error&&($(".about",t).html('<span class="auth_error">'+e.error_message+"</span>"),$("form",t).attr("action",e.connect_url),$("form button",t).text("Подключить"))})})}),$(document).ready(function(){$("#upgrade_settings_form").ajaxForm({form:$("#upgrade_settings_form"),beforeSubmit:ajaxFormBeforSubmit,error:ajaxFormError,url:"/json/settings/upgrade/ ",success:ajaxFormSuccess(function(e,t,s,o){return $.jGrowl("Приглашение активировано"),window.location="/",!1},function(e,t,s,o){"undefined"!=typeof Recaptcha&&Recaptcha.reload(),$("#imgCaptcha").size()&&($("#imgCaptcha").attr("src","/core/captcha?"+Math.random()),$("#captcha").val(""))})})}),$(document).ready(function(){$(".app_title").on("click",function(){var e=$(this).data("key");$("#text-"+e).toggle("slow"),$.post("/json/tracker/apps/mark_as_read/",{single:!0,key:e})}),$("#check_all").click(function(){$(".tracker_apps td input:checkbox").attr("checked",!!$(this).attr("checked")).trigger("change")}),$(".tracker_apps td input:checkbox").change(function(){$(".tracker_apps td input:checked").length>0?$("#remove_button, #mark_read_button").attr("disabled",!1):$("#remove_button, #mark_read_button").attr("disabled",!0)}),$("#remove_button").on("click",function(){return $("#tracker_apps_form").ajaxSubmit({form:$("#tracker_apps_form"),url:"/json/tracker/apps/remove/",beforeSubmit:ajaxFormBeforSubmit,error:ajaxFormError,success:ajaxFormSuccess(ajaxFormRedirect)}),!1}),$("#mark_read_button").on("click",function(){return $("#tracker_apps_form").ajaxSubmit({form:$("#tracker_apps_form"),url:"/json/tracker/apps/mark_as_read/",beforeSubmit:ajaxFormBeforSubmit,error:ajaxFormError,success:ajaxFormSuccess(ajaxFormRedirect)}),!1})}),$(document).ready(function(){$("#check_all").click(function(){$(".tracker_comments td input:checkbox").attr("checked",!!$(this).attr("checked")).trigger("change")}),$(".tracker_comments td input:checkbox").change(function(){$(".tracker_comments td input:checked").length>0?$(".remove_button, .mark_read_button").attr("disabled",!1):$(".remove_button, .mark_read_button").attr("disabled",!0)});var e=$("#tracker_feed_form");$(".remove_button").on("click",function(t){return t.preventDefault(),$(e).ajaxSubmit({form:$(e),url:"/json/tracker/feed/remove/",beforeSubmit:ajaxFormBeforSubmit,error:ajaxFormError,success:ajaxFormSuccess(ajaxFormRedirect)}),!1}),$(".mark_read_button").on("click",function(t){return t.preventDefault(),$(e).ajaxSubmit({form:$(e),url:"/json/tracker/feed/mark_as_read/",beforeSubmit:ajaxFormBeforSubmit,error:ajaxFormError,success:ajaxFormSuccess(ajaxFormRedirect)}),!1})});