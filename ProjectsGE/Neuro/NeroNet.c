#include "math.h"     // математические функции
#include "PACRXPlc.h" //процедуры для контроллера


static float off_1[] = {-6.6059587578557615,-4.3526093218402542,-9.6125377715099489,15.34654034935151,-10.41504843932894,
						15.297045460594161,-11.215883022458025,-4.7902903485636283,-4.7770801252432253,-1.8726623455616338};
#define off_2 0.25321147312764225;						

static float W1[10][3] ={{-0.00066743122035897099, -0.11206446014488511, 0.18019925126429742},
					{0.0003889544485913661, 0.15069729232506487, -0.081334441477852293}	,
					{0.00026009607440958632, 0.063526490616979098, 0.011797379523859338},
					{-0.00056972120462246755, -0.19132461828198041, 0.061199285317524492},
					{-0.099973635598832711, 2.8634131297756991, 16.717207768677095},
					{-0.00066887787432494861, -0.18010598749241391, 0.050904474640054258},
					{0.0059220906350217883, 0.11468973909442041, -0.0058271304410389968},
					{0.00040072708699105176, 0.15224871553489033, -0.080414211755419351},
					{-0.00029108067581634574, 0.221865316933716, 0.02397429792640738},
					{0.0030605711313751579, -0.096052630538237732, -0.032110165041128243}};
static float W2[] = {0.2014952594481072,-17.665856907001295,0.32895145996666803,-0.16313906729449315,-0.010968372198123189,-0.16608301452374061,0.4906858391457794,18.608278949900093,0.057164287403765564,-0.050891845936561014};
						
float tansig( float in )
{
float out;
out = (2 / (1+expf(-2*in))) - 1;
return out;
}


//int GefMain( unsigned int *in, float *res)
void GefMain( float *Nst, float *Ps, float *Pd, float *Qk, float *OUT)
//void GefMain( float *IN, float *Qk, float *OUT)
{
float IN[3], sum, LW_1[10], LW_2;
int i,j;

IN[0]= *Nst;
IN[1]= *Ps;
IN[2]= *Pd;


//           
for (j= 0; j<10; j++)
 {
 sum= 0;
 for (i= 0; i < 3; i++)
   sum= sum + IN[i] * W1[j][i];

   sum= sum + off_1[j];
   
 LW_1[j]= tansig(sum);
 }  //for j:= 1 to 10 do

sum= 0;
//           
  for (i= 0; i<10; i++) 
   sum= sum + LW_1[i] * W2[i];
  
   
  LW_2= sum + off_2;
 
*Qk= LW_2;

OUT[0] = IN[0];
OUT[1] = IN[1];
OUT[2] = IN[2];
	

}